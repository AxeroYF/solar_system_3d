<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D å¤ªé˜³ç³»æ¨¡æ‹Ÿ</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        #info {
            display: none; /* éšè—åŸæ¥çš„æç¤ºæ–‡å­— */
        }
        #help-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-family: sans-serif;
            font-size: 20px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 28px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10;
            transition: all 0.2s;
        }
        #help-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: white;
        }
        #help-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid #555;
            border-radius: 10px;
            padding: 25px;
            color: white;
            font-family: sans-serif;
            display: none;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            z-index: 100;
        }
        #help-panel h2 {
            margin-top: 0;
            color: #4FD0E7;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            text-align: center;
        }
        #help-panel ul {
            line-height: 1.8;
            font-size: 15px;
            color: #ddd;
            padding-left: 20px;
        }
        #help-panel .close-hint {
            margin-top: 20px;
            font-size: 13px;
            color: #888;
            text-align: center;
            cursor: pointer;
            padding: 5px;
        }
        #help-panel .close-hint:hover {
            color: white;
        }
        #planet-info-panel {
            position: absolute;
            top: 50%;
            left: 20px; /* å·¦ä¾§æ˜¾ç¤º */
            transform: translateY(-50%);
            width: 320px; /* ç¨å¾®åŠ å®½ */
            max-height: 80vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
            overflow-y: auto; /* å†…å®¹è¿‡å¤šæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid #555;
            border-radius: 10px;
            padding: 20px;
            color: white;
            font-family: sans-serif;
            display: none; /* é»˜è®¤éšè— */
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            z-index: 30;
            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin;
            scrollbar-color: #555 #222;
        }
        /* Webkit æ»šåŠ¨æ¡æ ·å¼ */
        #planet-info-panel::-webkit-scrollbar {
            width: 6px;
        }
        #planet-info-panel::-webkit-scrollbar-track {
            background: #222;
            border-radius: 3px;
        }
        #planet-info-panel::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 3px;
        }
        #planet-info-panel::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
        #planet-info-panel .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 28px;
            cursor: pointer;
            font-size: 20px;
            z-index: 40;
            transition: background 0.2s;
        }
        #planet-info-panel .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        #planet-info-panel h2 {
            margin-top: 0;
            color: #FFD700;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        #planet-preview-container {
            width: 100%;
            height: 200px;
            border-radius: 5px;
            margin-bottom: 10px;
            background: #000; /* é¢„è§ˆèƒŒæ™¯è‰² */
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #planet-photo-display {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }
        #planet-info-panel p {
            line-height: 1.5;
            font-size: 14px;
            color: #ddd;
        }
        #planet-info-panel .close-hint {
            margin-top: 15px;
            font-size: 12px;
            color: #888;
            text-align: center;
        }
        #planet-info-panel .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        #planet-info-panel button.nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            transition: background 0.2s;
        }
        #planet-info-panel button.nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        #planet-info-panel table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }
        #planet-info-panel td {
            padding: 5px 0;
            border-bottom: 1px solid #444;
        }
        #planet-info-panel td:first-child {
            color: #aaa;
            width: 40%;
        }
        #planet-info-panel td:last-child {
            color: #fff;
            text-align: right;
        }
        #time-display {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            pointer-events: none;
            text-align: right;
            text-shadow: 0 0 5px #000;
        }
        #controls-ui {
            position: absolute;
            top: 60px;
            right: 20px;
            color: white;
            font-family: sans-serif;
            text-align: right;
            z-index: 10;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
        }
        #speed-control {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        #pause-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid white;
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 5px;
            transition: background 0.3s;
        }
        #pause-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        #reset-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid #aaa;
            color: #ddd;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 8px;
            transition: all 0.3s;
        }
        #reset-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border-color: white;
        }
        input[type="range"] {
            cursor: pointer;
        }
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: sans-serif;
            font-size: 14px;
            pointer-events: none;
            display: none;
            border: 1px solid #444;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -150%); /* å±…ä¸­å¹¶åœ¨ä¸Šæ–¹æ˜¾ç¤º */
            z-index: 20;
            white-space: nowrap;
        }
        /* æ—¥æœŸé€‰æ‹©å™¨æ¨¡æ€æ¡†æ ·å¼ */
        #date-picker-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #555;
            border-radius: 10px;
            padding: 20px;
            color: white;
            font-family: sans-serif;
            display: none;
            z-index: 200;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            text-align: center;
            backdrop-filter: blur(10px);
        }
        #date-picker-modal h3 {
            margin-top: 0;
            color: #4FD0E7;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        .date-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .date-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .date-input-group label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
        }
        .date-inputs input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            color: white;
            padding: 8px;
            border-radius: 5px;
            font-size: 18px;
            width: 60px;
            text-align: center;
            outline: none;
        }
        .date-inputs input:focus {
            border-color: #4FD0E7;
            background: rgba(255, 255, 255, 0.2);
        }
        /* å»æ‰ number input çš„é»˜è®¤ç®­å¤´ */
        .date-inputs input::-webkit-outer-spin-button,
        .date-inputs input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .date-inputs input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        .modal-btn {
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            border: none;
            transition: background 0.2s;
        }
        .btn-confirm {
            background: #4FD0E7;
            color: #000;
            font-weight: bold;
        }
        .btn-confirm:hover {
            background: #79e0f2;
        }
        .btn-cancel {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        #time-display {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            pointer-events: auto; /* ä¿®å¤ç‚¹å‡»æ— ååº”çš„é—®é¢˜ */
            text-align: right;
            text-shadow: 0 0 5px #000;
            cursor: pointer; 
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s;
            z-index: 50; /* æé«˜å±‚çº§ */
        }
        #time-display:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: sans-serif;
            font-size: 20px;
            pointer-events: none;
        }
    </style>
    <!-- å¼•å…¥ Three.js å’Œ OrbitControls -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "@tweenjs/tween.js": "https://unpkg.com/@tweenjs/tween.js@23.1.1/dist/tween.esm.js"
            }
        }
    </script>
</head>
<body>
    <div id="info">
        <h1>3D å¤ªé˜³ç³»æ¨¡æ‹Ÿ</h1>
        <p>å·¦é”®æ—‹è½¬ | æ»šè½®ç¼©æ”¾ | æ–¹å‘é”®å¹³ç§»</p>
    </div>

    <div id="help-btn" title="å¸®åŠ©">?</div>

    <div id="help-panel">
        <h2>ç³»ç»Ÿå¸®åŠ©</h2>
        <ul>
            <li><b>æ—‹è½¬è§†è§’ï¼š</b> æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–åŠ¨</li>
            <li><b>ç¼©æ”¾è§†è§’ï¼š</b> æ»šåŠ¨é¼ æ ‡æ»šè½®</li>
            <li><b>å¹³ç§»è§†è§’ï¼š</b> æŒ‰ä½é¼ æ ‡ä¸­é”®æ‹–åŠ¨ æˆ– ä½¿ç”¨æ–¹å‘é”®/WASD</li>
            <li><b>è§¦å±æ“ä½œï¼š</b> å•æŒ‡æ—‹è½¬ï¼ŒåŒæŒ‡ç¼©æ”¾/å¹³ç§»</li>
            <li><b>æŸ¥çœ‹è¯¦æƒ…ï¼š</b> ç‚¹å‡»æ˜Ÿçƒå¯èšç„¦å¹¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
            <li><b>åˆ‡æ¢æ˜Ÿçƒï¼š</b> åœ¨è¯¦æƒ…é¡µç‚¹å‡» Prev/Next æˆ–ç›´æ¥ç‚¹å‡»å…¶ä»–æ˜Ÿçƒ</li>
            <li><b>æ—¶é—´æ§åˆ¶ï¼š</b> æ‹–åŠ¨æ»‘å—è°ƒæ•´é€Ÿåº¦ï¼Œç‚¹å‡»æš‚åœ/æ’­æ”¾ï¼Œæˆ–ç‚¹å‡»â€œå›åˆ°ä»Šå¤©â€</li>
            <li><b>æ—¥æœŸè·³è½¬ï¼š</b> ç‚¹å‡»å·¦ä¸Šè§’æ—¥æœŸæ˜¾ç¤ºåŒºåŸŸå¯æ‰‹åŠ¨è®¾å®šå¹´æœˆæ—¥</li>
            <li><b>æ˜¾ç¤ºè®¾ç½®ï¼š</b> å¼€å…³è¡Œæ˜Ÿ/å½—æ˜Ÿ/å«æ˜Ÿè½¨è¿¹ï¼Œåˆ‡æ¢â€œçœŸå®æ¯”ä¾‹æ¨¡å¼â€</li>
        </ul>
        <div class="close-hint" id="close-help">ç‚¹å‡»æ­¤å¤„æˆ–æŒ‰ ESC å…³é—­</div>
    </div>
    
    <!-- æ˜Ÿçƒè¯¦æƒ…é¢æ¿ -->
    <div id="planet-info-panel">
        <div class="close-btn" id="panel-close-btn">Ã—</div>
        <h2 id="panel-name">Planet Name</h2>
        <div id="planet-preview-container">
            <img id="planet-photo-display" src="" alt="Planet Photo">
        </div>
        <p id="panel-desc">Planet description goes here...</p>
        <div id="panel-stats"></div>
        <div class="nav-buttons">
            <button id="prev-btn" class="nav-btn">â† Prev</button>
            <button id="next-btn" class="nav-btn">Next â†’</button>
        </div>
        <div class="close-hint" id="panel-close-hint">ç‚¹å‡»æ­¤å¤„ æˆ– æŒ‰ ESC è¿”å›</div>
    </div>

    <!-- æ—¥æœŸé€‰æ‹©å™¨æ¨¡æ€æ¡† -->
    <div id="date-picker-modal">
        <h3>æ—¶é—´æ—…è¡Œ</h3>
        <div class="date-inputs">
            <div class="date-input-group">
                <label>å¹´</label>
                <input type="number" id="input-year" min="1000" max="9999" value="2024">
            </div>
            <div class="date-input-group">
                <label>æœˆ</label>
                <input type="number" id="input-month" min="1" max="12" value="1">
            </div>
            <div class="date-input-group">
                <label>æ—¥</label>
                <input type="number" id="input-day" min="1" max="31" value="1">
            </div>
        </div>
        <div class="modal-buttons">
            <button class="modal-btn btn-cancel" id="date-cancel">å–æ¶ˆ</button>
            <button class="modal-btn btn-confirm" id="date-confirm">ç¡®å®š</button>
        </div>
    </div>

    <div id="time-display" title="ç‚¹å‡»è°ƒæ•´æ—¶é—´">
        <div>Simulated Time</div>
        <div id="date-text">2024-01-01</div>
    </div>
    <div id="controls-ui">
        <div id="track-switches" style="margin-bottom: 10px;">
            <label><input type="checkbox" id="toggle-planet-tracks" checked> è¡Œæ˜Ÿè½¨è¿¹</label>
            <label style="margin-left: 8px;"><input type="checkbox" id="toggle-comet-tracks" checked> å½—æ˜Ÿè½¨è¿¹</label>
            <label style="margin-left: 8px;"><input type="checkbox" id="toggle-moon-tracks" checked> å«æ˜Ÿè½¨è¿¹</label>
        </div>
        <div id="speed-control">
            <label for="speed-slider">Time Speed: <span id="speed-value">1.0x</span></label>
            <!-- ä½¿ç”¨å¯¹æ•°åˆ»åº¦ï¼š0-1000 æ˜ å°„åˆ° 0.1 - 365 -->
            <!-- åˆå§‹å€¼ 1.0 å¯¹åº”: log(10)/log(3650) * 1000 â‰ˆ 281 -->
            <input type="range" id="speed-slider" min="0" max="1000" step="1" value="281">
            <label style="margin-top: 8px; cursor: pointer; font-size: 14px;">
                <input type="checkbox" id="toggle-real-scale"> çœŸå®æ¯”ä¾‹æ¨¡å¼
            </label>
            <button id="pause-btn">â¸ï¸ Pause</button>
            <button id="reset-btn">ğŸ”„ å›åˆ°ä»Šå¤©</button>
        </div>
    </div>
    <div id="tooltip"></div>
    <div id="loading">æ­£åœ¨åŠ è½½å®‡å®™...</div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import * as TWEEN from '@tweenjs/tween.js';

        // --- Shader å®šä¹‰ (å¤§æ°”å±‚å…‰æ™•) ---
        const atmosphereVertexShader = `
            varying vec3 vNormal;
            void main() {
                vNormal = normalize(normalMatrix * normal);
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `;

        const atmosphereFragmentShader = `
            varying vec3 vNormal;
            uniform vec3 glowColor;
            uniform float coef;
            uniform float power;
            uniform float opacity; // æ·»åŠ é€æ˜åº¦ uniform
            void main() {
                float intensity = pow(coef - dot(vNormal, vec3(0, 0, 1.0)), power);
                gl_FragColor = vec4(glowColor, 1.0) * intensity;
                gl_FragColor.a *= opacity; // åº”ç”¨æ•´ä½“é€æ˜åº¦
            }
        `;

        // --- ç¼ºå¤±çš„å˜é‡å®šä¹‰ ---
        const planets = [];
        const planetTracks = [];
        const moonTracks = [];
        const cometTracks = [];
        const cometTails = []; // å­˜å‚¨å½—å°¾å¯¹è±¡

        // çº¹ç†èµ„æºé“¾æ¥
        // 1. ä¸»è¦è¡Œæ˜Ÿä½¿ç”¨ threex.planets (jsDelivr)
        const texBase = "https://cdn.jsdelivr.net/gh/jeromeetienne/threex.planets/images/";
        // 2. å«æ˜Ÿä½¿ç”¨ 8ef/solar-system GitHub æº (åŒ…å« Phobos, Deimos, Io ç­‰)
        const moonBase = "https://raw.githubusercontent.com/8ef/solar-system/master/img/";
        
        const textures = {
            sun: texBase + 'sunmap.jpg',
            mercury: texBase + 'mercurymap.jpg',
            venus: texBase + 'venusmap.jpg',
            earth: texBase + 'earthmap1k.jpg',
            earthNormal: texBase + 'earthnormal1k.jpg', 
            earthSpecular: texBase + 'earthspec1k.jpg', 
            earthClouds: texBase + 'earthcloudmap.jpg',
            mars: texBase + 'marsmap1k.jpg',
            marsNormal: texBase + 'marsnormal1k.jpg',
            jupiter: texBase + 'jupitermap.jpg',
            saturn: texBase + 'saturnmap.jpg',
            saturnRing: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Solarsystemscope_texture_2k_saturn_ring.png/1024px-Solarsystemscope_texture_2k_saturn_ring.png', 
            uranus: texBase + 'uranusmap.jpg',
            neptune: texBase + 'neptunemap.jpg',
            moon: texBase + 'moonmap1k.jpg',
            
            // å«æ˜Ÿçº¹ç† (ä» 8ef ä»“åº“åŠ è½½)
            phobos: moonBase + 'phobos.jpg',
            deimos: moonBase + 'deimos.jpg',
            io: moonBase + 'io.jpg',
            europa: moonBase + 'europa.jpg',
            ganymede: moonBase + 'ganymede.jpg',
            callisto: moonBase + 'callisto.jpg',
            titan: moonBase + 'titan.jpg',
            triton: moonBase + 'triton.jpg',
            titania: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Titania_%28moon%29_color_cropped.jpg/800px-Titania_%28moon%29_color_cropped.jpg', // ä¿æŒåŸæº
            pluto: texBase + 'plutomap1k.jpg',
            charon: texBase + 'moonmap1k.jpg', // æš‚æ—¶å¤ç”¨æœˆçƒçº¹ç†ä½œä¸ºå†¥å«ä¸€
            ceres: texBase + 'ceresmap.jpg', // è°·ç¥æ˜Ÿ
            // ISS çº¹ç† (ä½¿ç”¨é‡‘å±è´¨æ„Ÿæˆ–ç®€å•çš„ç™½è‰²çº¹ç†)
            iss: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/International_Space_Station_after_undocking_of_STS-132.jpg/640px-International_Space_Station_after_undocking_of_STS-132.jpg',
            // ç”Ÿæˆå½—å°¾çº¹ç†
            cometTail: createCometTailTexture()
        };

        // ç”Ÿæˆç®€å•çš„å½—å°¾æ¸å˜çº¹ç†
        function createCometTailTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 64;
            canvas.height = 256;
            const context = canvas.getContext('2d');
            const gradient = context.createLinearGradient(0, 0, 0, 256);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
            gradient.addColorStop(0.4, 'rgba(200, 220, 255, 0.4)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            context.fillStyle = gradient;
            context.fillRect(0, 0, 64, 256);
            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // è¡Œæ˜Ÿæ•°æ®é…ç½®
        const planetData = [
            {
                name: "æ°´æ˜Ÿ",
                color: 0xA5A5A5,
                radius: 3.8,
                distance: 60,
                eccentricity: 0.2056,
                inclination: 7.0, 
                orbitalPeriod: 87.97,
                meanAnomalyJ2000: 174.79,
                speed: 0.04,
                rotateSpeed: 0.004,
                texture: textures.mercury,
                description: "æ°´æ˜Ÿæ˜¯å¤ªé˜³ç³»ä¸­æœ€å°çš„è¡Œæ˜Ÿï¼Œä¹Ÿæ˜¯æœ€æ¥è¿‘å¤ªé˜³çš„è¡Œæ˜Ÿã€‚å®ƒçš„è¡¨é¢å¸ƒæ»¡é™¨çŸ³å‘ï¼Œçœ‹èµ·æ¥ä¸æœˆçƒéå¸¸ç›¸ä¼¼ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "4,880 km", 
                    "è·ç¦»å¤ªé˜³": "0.39 AU",
                    "å…¬è½¬å‘¨æœŸ": "88 å¤©",
                    "è‡ªè½¬å‘¨æœŸ": "58.6 å¤©",
                    "è¡¨é¢æ¸©åº¦": "-173Â°C è‡³ 427Â°C",
                    "å«æ˜Ÿæ•°é‡": "0"
                },
                link: "https://zh.wikipedia.org/wiki/%E6%B0%B4%E6%98%9F"
            },
            {
                name: "é‡‘æ˜Ÿ",
                color: 0xE3BB76,
                radius: 9.5,
                distance: 90,
                eccentricity: 0.0067,
                inclination: 3.39,
                orbitalPeriod: 224.70,
                meanAnomalyJ2000: 50.11,
                speed: 0.015,
                rotateSpeed: -0.002,
                texture: textures.venus,
                description: "é‡‘æ˜Ÿæ˜¯ç¦»å¤ªé˜³ç¬¬äºŒè¿‘çš„è¡Œæ˜Ÿï¼Œä¹Ÿæ˜¯å¤œç©ºä¸­äº®åº¦ä»…æ¬¡äºæœˆçƒçš„å¤©ä½“ã€‚å®ƒæ‹¥æœ‰æµ“åšçš„å¤§æ°”å±‚ï¼Œæ¸©å®¤æ•ˆåº”å¯¼è‡´è¡¨é¢æ¸©åº¦æé«˜ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "12,104 km", 
                    "è·ç¦»å¤ªé˜³": "0.72 AU",
                    "å…¬è½¬å‘¨æœŸ": "224.7 å¤©",
                    "è‡ªè½¬å‘¨æœŸ": "243 å¤© (é€†è¡Œ)",
                    "è¡¨é¢æ¸©åº¦": "~462Â°C",
                    "å«æ˜Ÿæ•°é‡": "0"
                },
                link: "https://zh.wikipedia.org/wiki/%E9%87%91%E6%98%9F"
            },
            {
                name: "åœ°çƒ",
                color: 0x2233FF,
                radius: 10,
                distance: 130,
                eccentricity: 0.0167,
                inclination: 0.0, 
                orbitalPeriod: 365.25,
                meanAnomalyJ2000: 357.52,
                speed: 0.01,
                rotateSpeed: 0.02,
                texture: textures.earth,
                description: "åœ°çƒæ˜¯æˆ‘ä»¬å±…ä½çš„æ˜Ÿçƒï¼Œä¹Ÿæ˜¯ç›®å‰å·²çŸ¥å”¯ä¸€å­•è‚²ç”Ÿå‘½çš„æ˜Ÿçƒã€‚71%çš„è¡¨é¢è¢«æ°´è¦†ç›–ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "12,742 km", 
                    "è·ç¦»å¤ªé˜³": "1.00 AU",
                    "å…¬è½¬å‘¨æœŸ": "365.25 å¤©",
                    "è‡ªè½¬å‘¨æœŸ": "23å°æ—¶56åˆ†",
                    "è¡¨é¢æ¸©åº¦": "-88Â°C è‡³ 58Â°C",
                    "å«æ˜Ÿæ•°é‡": "1 (æœˆçƒ)"
                },
                link: "https://zh.wikipedia.org/wiki/%E5%9C%B0%E7%90%83",
                moons: [
                    {
                        name: "æœˆçƒ",
                        color: 0x888888,
                        radius: 2.7,
                        distance: 20,
                        speed: 0.05,
                        orbitalPeriod: 27.32, 
                        inclination: 5.14, // ç›¸å¯¹äºé»„é“é¢
                        texture: textures.moon,
                        description: "æœˆçƒæ˜¯åœ°çƒå”¯ä¸€çš„å¤©ç„¶å«æ˜Ÿï¼Œä¹Ÿæ˜¯å¤ªé˜³ç³»ç¬¬äº”å¤§å«æ˜Ÿã€‚",
                        details: {
                            "å¹³å‡ç›´å¾„": "3,474 km",
                            "è·åœ°è·ç¦»": "384,400 km",
                            "è½¨é“å‘¨æœŸ": "27.3 å¤©"
                        },
                        link: "https://zh.wikipedia.org/wiki/%E6%9C%88%E7%90%83"
                    },
                    {
                        name: "å›½é™…ç©ºé—´ç«™",
                        color: 0xDDDDDD,
                        radius: 0.5, // æå°ï¼Œç¤ºæ„æ€§
                        distance: 13, // ä½äºåœ°çƒ(10)å’Œæœˆçƒ(20)ä¹‹é—´ï¼Œéå¸¸è´´è¿‘åœ°çƒ
                        speed: 1.5, // é€Ÿåº¦æå¿« (90åˆ†é’Ÿä¸€åœˆ)
                        orbitalPeriod: 0.06458, // ~93 mins
                        inclination: 51.6, // è½¨é“å€¾è§’
                        texture: null, // ä½¿ç”¨æ¨¡å‹æˆ–ç®€å•å‡ ä½•ä½“
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/The_station_pictured_from_the_SpaceX_Crew_Dragon_5_%28cropped%29.jpg/800px-The_station_pictured_from_the_SpaceX_Crew_Dragon_5_%28cropped%29.jpg",
                        isSpacecraft: true, // æ ‡è®°ä¸ºèˆªå¤©å™¨
                        description: "å›½é™…ç©ºé—´ç«™ï¼ˆISSï¼‰æ˜¯ä½äºä½åœ°è½¨é“çš„æ¨¡å—åŒ–ç©ºé—´ç«™ï¼Œæ˜¯äººç±»å†å²ä¸Šæœ€å¤§çš„å¤ªç©ºå·¥ç¨‹ã€‚",
                        details: {
                            "é«˜åº¦": "~400 km",
                            "é€Ÿåº¦": "27,600 km/h",
                            "è½¨é“å‘¨æœŸ": "~93 åˆ†é’Ÿ",
                            "å‘å°„æ—¶é—´": "1998å¹´"
                        },
                        link: "https://zh.wikipedia.org/wiki/%E5%9B%BD%E9%99%85%E7%A9%BA%E9%97%B4%E7%AB%99"
                    }
                ]
            },
            {
                name: "ç«æ˜Ÿ",
                color: 0xDD4422,
                radius: 5.3,
                distance: 180,
                eccentricity: 0.0934,
                inclination: 1.85,
                orbitalPeriod: 686.98,
                meanAnomalyJ2000: 19.41,
                speed: 0.008,
                rotateSpeed: 0.018,
                texture: textures.mars,
                description: "ç«æ˜Ÿè¢«ç§°ä¸ºçº¢è‰²æ˜Ÿçƒï¼Œå…¶è¡¨é¢å‘ˆç°çº¢è‰²çš„èµ¤é“çŸ¿ã€‚å®ƒæ˜¯äººç±»æœªæ¥æ˜Ÿé™…ç§»æ°‘çš„é¦–é€‰ç›®æ ‡ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "6,779 km", 
                    "è·ç¦»å¤ªé˜³": "1.52 AU",
                    "å…¬è½¬å‘¨æœŸ": "687 å¤©",
                    "è‡ªè½¬å‘¨æœŸ": "24å°æ—¶37åˆ†",
                    "è¡¨é¢æ¸©åº¦": "-143Â°C è‡³ 35Â°C",
                    "å«æ˜Ÿæ•°é‡": "2"
                },
                link: "https://zh.wikipedia.org/wiki/%E7%81%AB%E6%98%9F",
                moons: [
                    {
                        name: "ç«å«ä¸€",
                        color: 0x887766,
                        radius: 1.0,
                        distance: 10,
                        speed: 0.05 * (27.3 / 0.32), // ~4.26
                        orbitalPeriod: 0.3189,
                        inclination: 1.09, // ç›¸å¯¹äºç«æ˜Ÿèµ¤é“
                        texture: textures.phobos,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Phobos_colour_2008.jpg/800px-Phobos_colour_2008.jpg", // Wiki Commons æº
                        irregular: true, // ä¸è§„åˆ™å½¢çŠ¶
                        scale: [1.3, 1.0, 0.8], // æ¨¡æ‹Ÿ Phobos çš„é•¿æ¡å½¢çŠ¶
                        description: "ç«å«ä¸€ï¼ˆPhobosï¼‰æ˜¯ç«æ˜Ÿä¸¤é¢—å«æ˜Ÿä¸­è¾ƒå¤§çš„ä¸€é¢—ã€‚",
                        details: { "è‹±æ–‡å": "Phobos", "ç›´å¾„": "22.5 km", "è½¨é“å‘¨æœŸ": "0.32 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E7%81%AB%E5%8D%AB%E4%B8%80"
                    },
                    {
                        name: "ç«å«äºŒ",
                        color: 0x998877,
                        radius: 0.6,
                        distance: 16,
                        speed: 0.05 * (27.3 / 1.26), // ~1.08
                        orbitalPeriod: 1.262,
                        inclination: 1.79, // ç›¸å¯¹äºç«æ˜Ÿèµ¤é“
                        texture: textures.deimos,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Deimos-MRO.jpg/800px-Deimos-MRO.jpg", // ä½¿ç”¨ MRO é«˜æ¸…å›¾
                        irregular: true, // ä¸è§„åˆ™å½¢çŠ¶
                        scale: [1.2, 1.0, 0.8], // æ¨¡æ‹Ÿ Deimos
                        description: "ç«å«äºŒï¼ˆDeimosï¼‰æ˜¯ç«æ˜Ÿè¾ƒå°ä¸”è¾ƒå¤–ä¾§çš„å«æ˜Ÿã€‚",
                        details: { "è‹±æ–‡å": "Deimos", "ç›´å¾„": "12.4 km", "è½¨é“å‘¨æœŸ": "1.26 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E7%81%AB%E5%8D%AB%E4%BA%8C"
                    }
                ]
            },
            {
                name: "è°·ç¥æ˜Ÿ",
                color: 0x888888,
                radius: 1.0, // æ¯”æœˆçƒ(2.7)å°
                distance: 220, // ä½äºå°è¡Œæ˜Ÿå¸¦ (200-250)
                eccentricity: 0.0758,
                inclination: 10.6,
                orbitalPeriod: 1681.6,
                meanAnomalyJ2000: 77.0,
                speed: 0.007,
                rotateSpeed: 0.05,
                texture: textures.ceres,
                realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/Ceres_-_RC3_-_Haulani_Crater_%2822381131691%29_%28cropped%29.jpg/800px-Ceres_-_RC3_-_Haulani_Crater_%2822381131691%29_%28cropped%29.jpg",
                description: "è°·ç¥æ˜Ÿï¼ˆCeresï¼‰æ˜¯ç«æ˜Ÿå’Œæœ¨æ˜Ÿä¹‹é—´å°è¡Œæ˜Ÿå¸¦ä¸­å”¯ä¸€çš„çŸ®è¡Œæ˜Ÿã€‚å®ƒæ˜¯å°è¡Œæ˜Ÿå¸¦ä¸­æœ€å¤§çš„å¤©ä½“ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "946 km", 
                    "è·ç¦»å¤ªé˜³": "2.77 AU",
                    "å…¬è½¬å‘¨æœŸ": "4.6 å¹´",
                    "è‡ªè½¬å‘¨æœŸ": "9å°æ—¶4åˆ†",
                    "è¡¨é¢æ¸©åº¦": "~-105Â°C",
                    "åˆ†ç±»": "çŸ®è¡Œæ˜Ÿ"
                },
                link: "https://zh.wikipedia.org/wiki/%E8%B0%B7%E7%A5%9E%E6%98%9F"
            },
            {
                name: "æœ¨æ˜Ÿ",
                color: 0xD9A066,
                radius: 30, 
                distance: 350,
                eccentricity: 0.0489,
                inclination: 1.3,
                orbitalPeriod: 4332.59,
                meanAnomalyJ2000: 20.02,
                speed: 0.004,
                rotateSpeed: 0.04,
                texture: textures.jupiter,
                description: "æœ¨æ˜Ÿæ˜¯å¤ªé˜³ç³»æœ€å¤§çš„è¡Œæ˜Ÿï¼Œæ˜¯ä¸€é¢—æ°”æ€å·¨è¡Œæ˜Ÿã€‚å®ƒæ‹¥æœ‰æ ‡å¿—æ€§çš„å¤§çº¢æ–‘é£æš´å’Œä¼—å¤šçš„å«æ˜Ÿã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "139,820 km", 
                    "è·ç¦»å¤ªé˜³": "5.20 AU",
                    "å…¬è½¬å‘¨æœŸ": "11.9 å¹´",
                    "è‡ªè½¬å‘¨æœŸ": "9å°æ—¶55åˆ†",
                    "ä¸»è¦æˆåˆ†": "æ°¢ã€æ°¦",
                    "å«æ˜Ÿæ•°é‡": "95+"
                },
                link: "https://zh.wikipedia.org/wiki/%E6%9C%A8%E6%98%9F",
                moons: [
                    {
                        name: "æœ¨å«ä¸€", // Io
                        color: 0xFFFF99,
                        radius: 2.8,
                        distance: 42,
                        speed: 0.05 * (27.3 / 1.77), // ~0.77
                        orbitalPeriod: 1.769,
                        inclination: 0.05, // æœ¨å«é€šå¸¸åœ¨èµ¤é“é¢
                        texture: textures.io,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Io_highest_resolution_true_color.jpg/800px-Io_highest_resolution_true_color.jpg",
                        description: "æœ¨å«ä¸€ï¼ˆIoï¼‰æ˜¯å¤ªé˜³ç³»ä¸­åœ°è´¨æ´»åŠ¨æœ€æ´»è·ƒçš„å¤©ä½“ï¼Œæ‹¥æœ‰400å¤šåº§æ´»ç«å±±ã€‚",
                        details: { "è‹±æ–‡å": "Io", "ç›´å¾„": "3,643 km", "è½¨é“å‘¨æœŸ": "1.77 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E6%9C%A8%E5%8D%AB%E4%B8%80"
                    },
                    {
                        name: "æœ¨å«äºŒ", // Europa
                        color: 0xDDDDFF,
                        radius: 2.5,
                        distance: 56,
                        speed: 0.05 * (27.3 / 3.55), // ~0.38
                        orbitalPeriod: 3.551,
                        inclination: 0.47,
                        texture: textures.europa,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Europa-moon-with-margins.jpg/800px-Europa-moon-with-margins.jpg",
                        description: "æœ¨å«äºŒï¼ˆEuropaï¼‰è¡¨é¢è¦†ç›–ç€å†°å±‚ï¼Œå†°ä¸‹å¯èƒ½å­˜åœ¨æ¶²æ€æµ·æ´‹ã€‚",
                        details: { "è‹±æ–‡å": "Europa", "ç›´å¾„": "3,122 km", "è½¨é“å‘¨æœŸ": "3.55 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E6%9C%A8%E5%8D%AB%E4%BA%8C"
                    },
                    {
                        name: "æœ¨å«ä¸‰", // Ganymede
                        color: 0xAAAAAA,
                        radius: 4.1,
                        distance: 72,
                        speed: 0.05 * (27.3 / 7.15), // ~0.19
                        orbitalPeriod: 7.154,
                        inclination: 0.20,
                        texture: textures.ganymede,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Ganymede_-_Perijove_34_Composite.png/800px-Ganymede_-_Perijove_34_Composite.png",
                        description: "æœ¨å«ä¸‰ï¼ˆGanymedeï¼‰æ˜¯å¤ªé˜³ç³»æœ€å¤§çš„å«æ˜Ÿï¼Œæ¯”æ°´æ˜Ÿè¿˜è¦å¤§ã€‚",
                        details: { "è‹±æ–‡å": "Ganymede", "ç›´å¾„": "5,268 km", "è½¨é“å‘¨æœŸ": "7.15 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E6%9C%A8%E5%8D%AB%E4%B8%89"
                    },
                    {
                        name: "æœ¨å«å››", // Callisto
                        color: 0x777777,
                        radius: 3.8,
                        distance: 90,
                        speed: 0.05 * (27.3 / 16.69), // ~0.08
                        orbitalPeriod: 16.689,
                        inclination: 0.28,
                        texture: textures.callisto,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Callisto.jpg/800px-Callisto.jpg",
                        description: "æœ¨å«å››ï¼ˆCallistoï¼‰æ˜¯å¤ªé˜³ç³»ä¸­è¡¨é¢é™¨çŸ³å‘æœ€å¤šçš„å¤©ä½“ä¹‹ä¸€ã€‚",
                        details: { "è‹±æ–‡å": "Callisto", "ç›´å¾„": "4,821 km", "è½¨é“å‘¨æœŸ": "16.69 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E6%9C%A8%E5%8D%AB%E5%9B%9B"
                    }
                ]
            },
            {
                name: "åœŸæ˜Ÿ",
                color: 0xEEDDAA,
                radius: 25,
                distance: 550,
                eccentricity: 0.0565,
                inclination: 2.48,
                orbitalPeriod: 10759.22,
                meanAnomalyJ2000: 317.02,
                speed: 0.003,
                rotateSpeed: 0.038,
                texture: textures.saturn,
                hasRing: true,
                ringTexture: textures.saturnRing,
                description: "åœŸæ˜Ÿä»¥å…¶å£®è§‚çš„è¡Œæ˜Ÿç¯ç³»ç»Ÿè€Œé—»åï¼Œæ˜¯å¤ªé˜³ç³»ç¬¬äºŒå¤§è¡Œæ˜Ÿï¼Œä¹Ÿæ˜¯å¯†åº¦æœ€å°çš„è¡Œæ˜Ÿï¼ˆå°äºæ°´ï¼‰ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "116,460 km", 
                    "è·ç¦»å¤ªé˜³": "9.58 AU",
                    "å…¬è½¬å‘¨æœŸ": "29.5 å¹´",
                    "è‡ªè½¬å‘¨æœŸ": "10å°æ—¶33åˆ†",
                    "ä¸»è¦æˆåˆ†": "æ°¢ã€æ°¦",
                    "å«æ˜Ÿæ•°é‡": "146+"
                },
                link: "https://zh.wikipedia.org/wiki/%E5%9C%9F%E6%98%9F",
                moons: [
                    {
                        name: "åœŸå«å…­", // Titan
                        color: 0xFFCC33,
                        radius: 4.0,
                        distance: 60,
                        speed: 0.05 * (27.3 / 15.95), // ~0.085
                        orbitalPeriod: 15.945,
                        inclination: 0.348, // ç›¸å¯¹åœŸæ˜Ÿèµ¤é“
                        texture: textures.titan,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/Titan_in_true_color.jpg/800px-Titan_in_true_color.jpg",
                        description: "åœŸå«å…­ï¼ˆTitanï¼‰æ˜¯åœŸæ˜Ÿæœ€å¤§çš„å«æ˜Ÿï¼Œä¹Ÿæ˜¯å¤ªé˜³ç³»å”¯ä¸€æ‹¥æœ‰æµ“åšå¤§æ°”å±‚çš„å«æ˜Ÿã€‚",
                        details: { "è‹±æ–‡å": "Titan", "ç›´å¾„": "5,150 km", "è½¨é“å‘¨æœŸ": "15.95 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E5%9C%9F%E5%8D%AB%E5%85%AD"
                    }
                ]
            },
            {
                name: "å¤©ç‹æ˜Ÿ",
                color: 0xACE5EE,
                radius: 18,
                distance: 800,
                eccentricity: 0.0463,
                inclination: 0.77,
                orbitalPeriod: 30685.4,
                meanAnomalyJ2000: 142.59,
                speed: 0.002,
                rotateSpeed: 0.03,
                texture: textures.uranus,
                description: "å¤©ç‹æ˜Ÿæ˜¯ä¸€é¢—å†°å·¨è¡Œæ˜Ÿï¼Œå®ƒæœ€ç‹¬ç‰¹çš„åœ°æ–¹åœ¨äºå…¶è‡ªè½¬è½´å‡ ä¹å¹³èººåœ¨è½¨é“é¢ä¸Šã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "50,724 km", 
                    "è·ç¦»å¤ªé˜³": "19.2 AU",
                    "å…¬è½¬å‘¨æœŸ": "84 å¹´",
                    "è‡ªè½¬å‘¨æœŸ": "17å°æ—¶14åˆ†",
                    "è¡¨é¢æ¸©åº¦": "~-197Â°C",
                    "å«æ˜Ÿæ•°é‡": "27"
                },
                link: "https://zh.wikipedia.org/wiki/%E5%A4%A9%E7%8E%8B%E6%98%9F",
                moons: [
                    {
                        name: "å¤©å«ä¸‰", // Titania
                        color: 0xDDDDDD,
                        radius: 2.0,
                        distance: 40,
                        speed: 0.05 * (27.3 / 8.7), // ~0.157
                        orbitalPeriod: 8.706,
                        inclination: 0.34, // ç›¸å¯¹å¤©ç‹æ˜Ÿèµ¤é“ (æ³¨æ„å¤©ç‹æ˜Ÿæœ¬èº«å€¾è§’å¾ˆå¤§)
                        texture: textures.titania,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Titania_%28moon%29_color_cropped.jpg/800px-Titania_%28moon%29_color_cropped.jpg",
                        description: "å¤©å«ä¸‰ï¼ˆTitaniaï¼‰æ˜¯å¤©ç‹æ˜Ÿæœ€å¤§çš„å«æ˜Ÿã€‚",
                        details: { "è‹±æ–‡å": "Titania", "ç›´å¾„": "1,577 km", "è½¨é“å‘¨æœŸ": "8.7 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E5%A4%A9%E5%8D%AB%E4%B8%89"
                    }
                ]
            },
            {
                name: "æµ·ç‹æ˜Ÿ",
                color: 0x5566FF,
                radius: 17,
                distance: 1000,
                eccentricity: 0.0086,
                inclination: 1.77,
                orbitalPeriod: 60189.0,
                meanAnomalyJ2000: 260.25,
                speed: 0.001,
                rotateSpeed: 0.032,
                texture: textures.neptune,
                description: "æµ·ç‹æ˜Ÿæ˜¯å¤ªé˜³ç³»å·²çŸ¥æœ€è¿œçš„è¡Œæ˜Ÿï¼Œæ˜¯ä¸€é¢—æ·±è“è‰²çš„å†°å·¨è¡Œæ˜Ÿï¼Œæ‹¥æœ‰å¤ªé˜³ç³»æœ€å¼ºçƒˆçš„é£æš´ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "49,244 km", 
                    "è·ç¦»å¤ªé˜³": "30.1 AU",
                    "å…¬è½¬å‘¨æœŸ": "164.8 å¹´",
                    "è‡ªè½¬å‘¨æœŸ": "16å°æ—¶6åˆ†",
                    "è¡¨é¢æ¸©åº¦": "~-201Â°C",
                    "å«æ˜Ÿæ•°é‡": "14"
                },
                link: "https://zh.wikipedia.org/wiki/%E6%B5%B7%E7%8E%8B%E6%98%9F",
                moons: [
                    {
                        name: "æµ·å«ä¸€", // Triton
                        color: 0xAAAAFF,
                        radius: 2.5,
                        distance: 40,
                        speed: -0.05 * (27.3 / 5.88), // ~ -0.23 (é€†è¡Œ)
                        orbitalPeriod: 5.877,
                        inclination: 156.885, // é€†è¡Œè½¨é“ï¼Œå€¾è§’æå¤§
                        texture: textures.triton,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Triton_moon_mosaic_Voyager_2_%28large%29.jpg/800px-Triton_moon_mosaic_Voyager_2_%28large%29.jpg", // ä½¿ç”¨ Voyager 2 æ‹¼æ¥å›¾
                        description: "æµ·å«ä¸€ï¼ˆTritonï¼‰æ˜¯æµ·ç‹æ˜Ÿæœ€å¤§çš„å«æ˜Ÿï¼Œä¹Ÿæ˜¯å¤ªé˜³ç³»å”¯ä¸€æ‹¥æœ‰é€†è¡Œè½¨é“çš„å¤§å«æ˜Ÿã€‚",
                        details: { "è‹±æ–‡å": "Triton", "ç›´å¾„": "2,707 km", "è½¨é“å‘¨æœŸ": "-5.88 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E6%B5%B7%E5%8D%AB%E4%B8%80"
                    }
                ]
            },
            {
                name: "å†¥ç‹æ˜Ÿ",
                color: 0xDDAA88,
                radius: 2.3,
                distance: 1250,
                eccentricity: 0.248,
                inclination: 17.16,
                orbitalPeriod: 90560.0,
                meanAnomalyJ2000: 14.88,
                speed: 0.0008,
                rotateSpeed: 0.005,
                texture: textures.pluto,
                description: "å†¥ç‹æ˜Ÿæ˜¯æŸ¯ä¼Šä¼¯å¸¦ä¸­æœ€å¤§çš„å¤©ä½“ä¹‹ä¸€ï¼Œæ›¾è¢«åˆ—ä¸ºä¹å¤§è¡Œæ˜Ÿã€‚å®ƒç”±å²©çŸ³å’Œå†°ç»„æˆï¼Œæ‹¥æœ‰ä¸€é¢—ç›¸å¯¹å·¨å¤§çš„å«æ˜Ÿâ€”â€”å†¥å«ä¸€ã€‚",
                details: { 
                    "å¹³å‡ç›´å¾„": "2,377 km", 
                    "è·ç¦»å¤ªé˜³": "39.5 AU",
                    "å…¬è½¬å‘¨æœŸ": "248 å¹´",
                    "è‡ªè½¬å‘¨æœŸ": "6.4 å¤©",
                    "è¡¨é¢æ¸©åº¦": "~-229Â°C",
                    "å«æ˜Ÿæ•°é‡": "5"
                },
                link: "https://zh.wikipedia.org/wiki/%E5%86%A5%E7%8E%8B%E6%98%9F",
                moons: [
                    {
                        name: "å†¥å«ä¸€", // Charon
                        color: 0xCCCCCC,
                        radius: 1.2,
                        distance: 8,
                        speed: 0.05 * (27.3 / 6.4), 
                        orbitalPeriod: 6.387,
                        inclination: 0.0, // ä¸å†¥ç‹æ˜Ÿäº’é”
                        texture: textures.charon,
                        realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Charon_in_True_Color_-_High-Res.jpg/800px-Charon_in_True_Color_-_High-Res.jpg",
                        description: "å†¥å«ä¸€ï¼ˆCharonï¼‰æ˜¯å†¥ç‹æ˜Ÿæœ€å¤§çš„å«æ˜Ÿï¼Œä¸å†¥ç‹æ˜Ÿå½¢æˆåŒçŸ®è¡Œæ˜Ÿç³»ç»Ÿã€‚",
                        details: { "è‹±æ–‡å": "Charon", "ç›´å¾„": "1,212 km", "è½¨é“å‘¨æœŸ": "6.4 å¤©" },
                        link: "https://zh.wikipedia.org/wiki/%E5%86%A5%E5%8D%AB%E4%B8%80"
                    }
                ]
            },
            {
                name: "å“ˆé›·å½—æ˜Ÿ",
                color: 0xAAAAAA, // æ¢å¤ç°è‰²ï¼Œå› ä¸ºæœ‰è´´å›¾äº†
                radius: 1.5, 
                // é»˜è®¤æ¨¡å¼è½¨é“ä¼˜åŒ–ï¼š
                // å¤ªé˜³åŠå¾„30ã€‚ä¸ºäº†é¿å…è¿‘æ—¥ç‚¹(30ä»¥å†…)ç©¿æ¨¡ï¼Œæˆ‘ä»¬è®¾è¿‘æ—¥ç‚¹ q â‰ˆ 40
                // è¿œæ—¥ç‚¹ Q è®¾ä¸º 900 (åœ¨å¤©ç‹æ˜Ÿå’Œæµ·ç‹æ˜Ÿä¹‹é—´)
                // a = (40+900)/2 = 470
                // e = (900-40)/940 â‰ˆ 0.915
                distance: 470, 
                eccentricity: 0.915, 
                inclination: 162.26, // é€†è¡Œ
                orbitalPeriod: 27510, // ~75.32 years
                meanAnomalyJ2000: 66.4, // 1986å¹´è¿‘æ—¥ç‚¹ï¼Œ2000å¹´å·²è¿‡è¿‘æ—¥ç‚¹çº¦14å¹´
                speed: 0.01 / 76.0, 
                rotateSpeed: 0.05,
                texture: textures.halley, 
                realPhoto: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Lspn_comet_halley.jpg/800px-Lspn_comet_halley.jpg", // Wiki æº
                irregular: true, // æ ‡è®°ä¸ºä¸è§„åˆ™å½¢çŠ¶
                scale: [1.5, 1.0, 0.8], // å½¢çŠ¶æ‹‰ä¼¸æ¯”ä¾‹ (é•¿å®½é«˜)
                description: "å“ˆé›·å½—æ˜Ÿæ˜¯è‘—åçš„çŸ­å‘¨æœŸå½—æ˜Ÿï¼Œæ¯éš”75-76å¹´å°±èƒ½ä»åœ°çƒä¸Šç”¨è‚‰çœ¼çœ‹åˆ°ã€‚å®ƒæ˜¯å”¯ä¸€èƒ½ç”¨è£¸çœ¼ç›´æ¥ä»åœ°çƒçœ‹è§çš„çŸ­å‘¨æœŸå½—æ˜Ÿã€‚",
                details: {
                    "å¹³å‡ç›´å¾„": "11 km",
                    "è¿‘æ—¥ç‚¹": "0.6 AU",
                    "è¿œæ—¥ç‚¹": "35.1 AU",
                    "è½¨é“å‘¨æœŸ": "76.1 å¹´",
                    "ç¦»å¿ƒç‡": "0.967"
                },
                link: "https://zh.wikipedia.org/wiki/%E5%93%88%E9%9B%B7%E5%BD%97%E6%98%9F"
            }
        ];

        // åœºæ™¯é…ç½®
        const scene = new THREE.Scene();
        
        // é›¾åŒ–æ•ˆæœï¼Œå¢åŠ æ·±é‚ƒæ„Ÿ (é™ä½å¯†åº¦ï¼Œé˜²æ­¢è¿œè·ç¦»è¿‡æš—)
        // ä¿®æ”¹ï¼šå¤§å¹…é™ä½é›¾æµ“åº¦ï¼Œé˜²æ­¢æ˜Ÿçƒåœ¨è¿œå¤„å˜å¾—ä¸å¯è§
        scene.fog = new THREE.FogExp2(0x000000, 0.00002);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 30000);
        camera.position.set(0, 200, 400); // åˆå§‹è§†è§’

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true; // å¼€å¯é˜´å½±
        document.body.appendChild(renderer.domElement);

        // æ§åˆ¶å™¨
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 2; // å…è®¸æ”¾å¤§åˆ°æ›´è¿‘ï¼Œæ–¹ä¾¿è§‚å¯Ÿå°å«æ˜Ÿ
        controls.maxDistance = 25000;
        // å¯ç”¨é¼ æ ‡ä¸­é”®å¹³ç§»
        controls.enablePan = true; 
        // è‡ªå®šä¹‰æŒ‰é”®æ˜ å°„: å·¦é”®æ—‹è½¬, ä¸­é”®å¹³ç§», å³é”®æ— (æˆ–ç¼©æ”¾)
        controls.mouseButtons = {
            LEFT: THREE.MOUSE.ROTATE,
            MIDDLE: THREE.MOUSE.PAN,
            RIGHT: THREE.MOUSE.DOLLY
        };

        // --- é”®ç›˜æ§åˆ¶é€»è¾‘ ---
        const keyState = {
            ArrowUp: false,
            ArrowDown: false,
            ArrowLeft: false,
            ArrowRight: false,
            w: false, s: false, a: false, d: false
        };

        window.addEventListener('keydown', (e) => {
            if (keyState.hasOwnProperty(e.key)) keyState[e.key] = true;
        });

        window.addEventListener('keyup', (e) => {
            if (keyState.hasOwnProperty(e.key)) keyState[e.key] = false;
        });

        // ç§»åŠ¨ç›¸æœºå‡½æ•°
        function updateCameraPosition() {
            const moveSpeed = 2.0 * (camera.position.y / 200); // æ ¹æ®é«˜åº¦è°ƒæ•´ç§»åŠ¨é€Ÿåº¦
            
            // è·å–ç›¸æœºæ–¹å‘çš„å‰æ–¹å’Œå³æ–¹å‘é‡ï¼ˆæŠ•å½±åˆ° XZ å¹³é¢ï¼‰
            const forward = new THREE.Vector3();
            camera.getWorldDirection(forward);
            forward.y = 0;
            forward.normalize();

            const right = new THREE.Vector3();
            right.crossVectors(forward, camera.up).normalize();

            if (keyState.ArrowUp || keyState.w) {
                camera.position.addScaledVector(forward, moveSpeed);
                controls.target.addScaledVector(forward, moveSpeed);
            }
            if (keyState.ArrowDown || keyState.s) {
                camera.position.addScaledVector(forward, -moveSpeed);
                controls.target.addScaledVector(forward, -moveSpeed);
            }
            if (keyState.ArrowLeft || keyState.a) {
                camera.position.addScaledVector(right, -moveSpeed);
                controls.target.addScaledVector(right, -moveSpeed);
            }
            if (keyState.ArrowRight || keyState.d) {
                camera.position.addScaledVector(right, moveSpeed);
                controls.target.addScaledVector(right, moveSpeed);
            }
        }

        // åŠ è½½ç®¡ç†å™¨
        const loadingManager = new THREE.LoadingManager();
        loadingManager.onLoad = function ( ) {
            const loadingScreen = document.getElementById( 'loading' );
            loadingScreen.style.display = 'none';
        };
        loadingManager.onError = function ( url ) {
            console.log( 'There was an error loading ' + url );
            // å³ä½¿å‡ºé”™ä¹Ÿéšè—ï¼Œé¿å…ä¸€ç›´å¡ä½
            document.getElementById( 'loading' ).style.display = 'none';
        };

        const textureLoader = new THREE.TextureLoader(loadingManager);
        textureLoader.setCrossOrigin('anonymous'); // è§£å†³è·¨åŸŸå›¾ç‰‡åŠ è½½é—®é¢˜

        // --- åˆ›å»ºå¯¹è±¡ ---

        // 1. æ˜Ÿç©ºèƒŒæ™¯ (ç²’å­ç³»ç»Ÿ)
        function createStars() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            // å¢åŠ æ˜Ÿæ˜Ÿæ•°é‡å’Œåˆ†å¸ƒèŒƒå›´ï¼Œä»¥è¦†ç›–çœŸå®æ¯”ä¾‹ä¸‹çš„å¤ªé˜³ç³» (å†¥ç‹æ˜Ÿæœ€è¿œçº¦ 8000-10000)
            for (let i = 0; i < 50000; i++) {
                const x = THREE.MathUtils.randFloatSpread(60000); // åŸ 4000 -> 60000
                const y = THREE.MathUtils.randFloatSpread(60000);
                const z = THREE.MathUtils.randFloatSpread(60000);
                vertices.push(x, y, z);
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5 }); 
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }
        createStars();

        // 2. å¤ªé˜³
        const sunGeometry = new THREE.SphereGeometry(30, 64, 64);
        const sunMaterial = new THREE.MeshBasicMaterial({ 
            color: 0xFFD700 // é»˜è®¤é‡‘é»„ï¼Œé˜²æ­¢çº¹ç†åŠ è½½å¤±è´¥
        });
        const sun = new THREE.Mesh(sunGeometry, sunMaterial);
        // ç¡®ä¿å¤ªé˜³ä¸æŠ•å°„é˜´å½±ï¼Œå¦åˆ™å…‰æºåœ¨å†…éƒ¨ä¼šå¯¼è‡´æ•´ä¸ªç³»é»‘æš—
        sun.castShadow = false; 
        sun.receiveShadow = false;

        sun.userData = { 
            name: "å¤ªé˜³",
            description: "å¤ªé˜³æ˜¯ä½äºå¤ªé˜³ç³»ä¸­å¿ƒçš„æ’æ˜Ÿï¼Œå®ƒå‡ ä¹æ˜¯çƒ­ç­‰ç¦»å­ä½“ä¸ç£åœºäº¤ç»‡ç€çš„ä¸€ä¸ªç†æƒ³çƒä½“ã€‚å¤ªé˜³ç³»ä¸­99.86%çš„è´¨é‡é›†ä¸­åœ¨å¤ªé˜³ã€‚",
            details: {
                "è·ç¦»å¤ªé˜³": "0 AU",
                "ç›´å¾„": "1,392,700 km",
                "è´¨é‡": "333,000 Earths",
                "å…¬è½¬å‘¨æœŸ": "N/A (é“¶æ²³ç³»: ~2.3äº¿å¹´)",
                "è‡ªè½¬å‘¨æœŸ": "~27 Days",
                "è‹±æ–‡å": "Sun"
            },
            link: "https://zh.wikipedia.org/wiki/%E5%A4%AA%E9%98%B3"
        };
        
        textureLoader.load(
            textures.sun, 
            (tex) => {
                tex.colorSpace = THREE.SRGBColorSpace;
                sunMaterial.map = tex;
                sunMaterial.color.setHex(0xffffff); // åŠ è½½æˆåŠŸåè®¾ä¸ºç™½è‰²ï¼Œæ˜¾ç¤ºçº¹ç†åŸè‰²
                sunMaterial.needsUpdate = true;
            },
            undefined,
            (err) => console.log("å¤ªé˜³çº¹ç†åŠ è½½å¤±è´¥ï¼Œä¿æŒçº¯è‰²")
        );
        scene.add(sun);

        // 2.1 å°è¡Œæ˜Ÿå¸¦ (Asteroid Belt)
        function createAsteroidBelt() {
            const particleCount = 3000;
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];
            const color = new THREE.Color();
            
            // ç«æ˜Ÿ(180) å’Œ æœ¨æ˜Ÿ(350) ä¹‹é—´ï¼Œå¤§çº¦åœ¨ 200-250 èŒƒå›´ (ç»™æœ¨æ˜Ÿå«æ˜Ÿç•™å‡ºç©ºé—´)
            const innerRadius = 200;
            const outerRadius = 250;

            for (let i = 0; i < particleCount; i++) {
                // éšæœºåŠå¾„
                const r = innerRadius + Math.random() * (outerRadius - innerRadius);
                // éšæœºè§’åº¦
                const theta = Math.random() * Math.PI * 2;
                // å‚ç›´åˆ†å¸ƒ (ç¨å¾®æœ‰ä¸€äº›åšåº¦)
                const y = (Math.random() - 0.5) * 10; 

                const x = r * Math.cos(theta);
                const z = r * Math.sin(theta);

                positions.push(x, y, z);

                // é¢œè‰²éšæœºå˜åŒ– (ç°è‰²/è¤è‰²)
                const grayLevel = 0.4 + Math.random() * 0.4;
                color.setRGB(grayLevel, grayLevel * 0.9, grayLevel * 0.8);
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({ 
                size: 1.5, 
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                sizeAttenuation: true
            });

            const asteroidBelt = new THREE.Points(geometry, material);
            asteroidBelt.userData = {
                name: "å°è¡Œæ˜Ÿå¸¦",
                description: "å°è¡Œæ˜Ÿå¸¦æ˜¯ä½äºç«æ˜Ÿå’Œæœ¨æ˜Ÿè½¨é“ä¹‹é—´çš„å°è¡Œæ˜Ÿå¯†é›†åŒºåŸŸï¼Œä¼°è®¡åŒ…å«æ•°ç™¾ä¸‡é¢—å°è¡Œæ˜Ÿã€‚",
                tooltipSuffix: " (Asteroid Belt)" // ç”¨äºé¼ æ ‡æ‚¬åœæç¤º
            };
            scene.add(asteroidBelt);
            
            // æ—‹è½¬åŠ¨ç”»é€»è¾‘éœ€è¦å•ç‹¬å¤„ç†ï¼Œä¿å­˜å¼•ç”¨
            // ä¿å­˜åŸå§‹ geometry ä¾›ç¼©æ”¾æ¢å¤
            asteroidBelt.userData.originalGeometry = geometry.clone();
            return asteroidBelt;
        }
        
        const asteroidBeltMesh = createAsteroidBelt();

        // 2.2 æŸ¯ä¼Šä¼¯å¸¦ (Kuiper Belt)
        function createKuiperBelt() {
            const particleCount = 6000;
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];
            const color = new THREE.Color();
            
            // æµ·ç‹æ˜Ÿ (1000) å¤–ä¾§ï¼ŒèŒƒå›´çº¦ 1100 - 1600
            const innerRadius = 1100;
            const outerRadius = 1600;

            for (let i = 0; i < particleCount; i++) {
                const r = innerRadius + Math.random() * (outerRadius - innerRadius);
                const theta = Math.random() * Math.PI * 2;
                // æŸ¯ä¼Šä¼¯å¸¦æ¯”å°è¡Œæ˜Ÿå¸¦æ›´åšä¸€äº›
                const y = (Math.random() - 0.5) * 60; 

                const x = r * Math.cos(theta);
                const z = r * Math.sin(theta);

                positions.push(x, y, z);

                // é¢œè‰²åå†· (å†°å†·å¤©ä½“)
                // è“ç°è‰²è°ƒ
                const grayLevel = 0.5 + Math.random() * 0.3;
                color.setRGB(grayLevel * 0.8, grayLevel * 0.9, grayLevel); 
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({ 
                size: 2.0, 
                vertexColors: true,
                transparent: true,
                opacity: 0.6,
                sizeAttenuation: true
            });

            const kuiperBelt = new THREE.Points(geometry, material);
            kuiperBelt.userData = {
                name: "æŸ¯ä¼Šä¼¯å¸¦",
                description: "æŸ¯ä¼Šä¼¯å¸¦æ˜¯ä½äºæµ·ç‹æ˜Ÿè½¨é“å¤–ä¾§çš„åœ†ç›˜çŠ¶åŒºåŸŸï¼ŒåŒ…å«å¤§é‡å†°å†»å°å¤©ä½“ï¼Œæ˜¯çŸ­å‘¨æœŸå½—æ˜Ÿçš„æ¥æºåœ°ã€‚",
                tooltipSuffix: " (Kuiper Belt)"
            };
            scene.add(kuiperBelt);
            
            // ä¿å­˜åŸå§‹ Geometry ä¾›ç¼©æ”¾æ¢å¤
            kuiperBelt.userData.originalGeometry = geometry.clone();
            return kuiperBelt;
        }

        const kuiperBeltMesh = createKuiperBelt();


        // å¤ªé˜³å…‰ (ç‚¹å…‰æº) - è°ƒæ•´èŒƒå›´
        const sunLight = new THREE.PointLight(0xffffff, 1.2, 10000, 0); 
        sunLight.position.set(0, 0, 0);
        sunLight.castShadow = true;
        sunLight.shadow.bias = -0.0001;
        // å¢åŠ é˜´å½±è´´å›¾åˆ†è¾¨ç‡ï¼Œå‡å°‘é”¯é½¿
        sunLight.shadow.mapSize.width = 2048;
        sunLight.shadow.mapSize.height = 2048;
        scene.add(sunLight);

        // ç¯å¢ƒå…‰ - æé«˜äº®åº¦ï¼Œé¿å…èƒŒå…‰é¢å¤ªæš—
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6); 
        scene.add(ambientLight);
        
        // åŠçƒå…‰ - å¢å¼ºä¸€ç‚¹åœ°é¢åå°„å…‰
        const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x000000, 0.2);
        scene.add(hemisphereLight);

        // --- åˆå§‹ä½ç½®è®¡ç®—ç›¸å…³ ---
        // J2000 åŸºå‡†æ—¶é—´ (2000-01-01 12:00 UTC)
        const J2000_DATE = new Date('2000-01-01T12:00:00Z');
        const MS_PER_DAY = 86400000;
        const baseDate = new Date(); // æ¨¡æ‹Ÿæ¨¡å¼çš„åŸºå‡†æ—¶é—´ (é»˜è®¤ä¸ºå½“å‰æ—¶é—´)

        // è®¡ç®—ç‰¹å®šæ—¥æœŸçš„å¹³è¿‘ç‚¹è§’ (Mean Anomaly)
        function calculateMeanAnomaly(periodDays, meanAnomalyJ2000, targetDate) {
            if (!periodDays) return Math.random() * Math.PI * 2; // å¦‚æœæ²¡æœ‰å‘¨æœŸæ•°æ®ï¼Œéšæœº
            
            const daysSinceJ2000 = (targetDate - J2000_DATE) / MS_PER_DAY;
            const meanMotion = 360 / periodDays; // æ¯æ—¥è¿åŠ¨è§’åº¦
            
            let currentMeanAnomaly = meanAnomalyJ2000 + meanMotion * daysSinceJ2000;
            
            // å½’ä¸€åŒ–åˆ° 0-360
            currentMeanAnomaly = currentMeanAnomaly % 360;
            if (currentMeanAnomaly < 0) currentMeanAnomaly += 360;
            
            return currentMeanAnomaly * (Math.PI / 180); // è½¬æ¢ä¸ºå¼§åº¦
        }

        // 3. åˆ›å»ºè¡Œæ˜Ÿå‡½æ•°
        function createPlanet(data) {
            // è®¡ç®—è½¨é“å‚æ•°
            const a = data.distance; // åŠé•¿è½´
            const e = data.eccentricity || 0; // ç¦»å¿ƒç‡
            const b = a * Math.sqrt(1 - e * e); // åŠçŸ­è½´
            const c = a * e; // ç„¦è· (åç§»é‡ï¼Œå¤ªé˜³ä½äºç„¦ç‚¹)
            const inclination = (data.inclination || 0) * (Math.PI / 180); // è½¬æ¢ä¸ºå¼§åº¦

            // ...
            const systemGroup = new THREE.Group();
            
            // åˆ›å»ºä¸€ä¸ªè½¨é“å®¹å™¨ï¼Œç”¨äºåº”ç”¨å€¾è§’
            const orbitGroup = new THREE.Group();
            orbitGroup.add(systemGroup); // è¡Œæ˜Ÿç³»ç»Ÿï¼ˆåŒ…å«å«æ˜Ÿï¼‰æ”¾å…¥è½¨é“å®¹å™¨
            
            // åº”ç”¨è½¨é“å€¾è§’ (ç»• Z è½´æˆ– X è½´æ—‹è½¬)
            // è¿™é‡Œæˆ‘ä»¬ç»• X è½´æ—‹è½¬ï¼Œæ¨¡æ‹Ÿå¯¹é»„é“é¢çš„å€¾æ–œ
            // ä¸ºäº†è®©å€¾æ–œæ–¹å‘ä¸åŒï¼Œå¯ä»¥ç¨å¾®éšæœºåŒ–ä¸€ä¸‹å‡äº¤ç‚¹ç»åº¦ï¼Œæˆ–è€…ç®€åŒ–å¤„ç†åªå€¾æ–œ
            orbitGroup.rotation.x = inclination;
            // ç¨å¾®æ—‹è½¬ä¸€ä¸‹å‡äº¤ç‚¹ (Long. of Ascending Node)ï¼Œè®©å€¾æ–œæ–¹å‘ä¸å®Œå…¨ä¸€è‡´ï¼Œæ›´è‡ªç„¶
            orbitGroup.rotation.y = Math.random() * Math.PI; 

            scene.add(orbitGroup);

            // åˆå§‹åŒ–æè´¨
            // ä½¿ç”¨ Lambert æè´¨
            const material = new THREE.MeshLambertMaterial({
                color: data.color, // åˆå§‹é¢œè‰²ï¼ŒåŠ è½½çº¹ç†åä¼šè®¾ä¸ºç™½è‰²
                emissive: 0x222222, // å¢åŠ è‡ªå‘å…‰ï¼Œç¡®ä¿åœ¨è¿œå¤„/èƒŒå…‰é¢ä¹Ÿèƒ½çœ‹åˆ°
                emissiveIntensity: 0.5
            });

            // å¦‚æœæ˜¯å½—æ˜Ÿï¼Œåˆ›å»ºå½—å°¾
            if (data.type === "comet") {
                // ä½¿ç”¨åœ†æŸ±ä½“æ¨¡æ‹Ÿå½—å°¾
                const tailLength = 60; // åˆå§‹é•¿åº¦
                // CylinderGeometry(radiusTop, radiusBottom, height, radialSegments)
                // ä¸Šå¤§ä¸‹å°(0)ï¼Œæ¨¡æ‹Ÿé”¥å½¢
                const tailGeo = new THREE.CylinderGeometry(data.radius * 1.2, 0, tailLength, 32, 1, true);
                // å°†å‡ ä½•ä½“åŸç‚¹ç§»åˆ°é¡¶éƒ¨ä¸­å¿ƒï¼Œæ–¹ä¾¿å®šä½åˆ°å½—æ˜Ÿä¸­å¿ƒ
                tailGeo.translate(0, -tailLength / 2, 0);
                // æ—‹è½¬ä½¿å…¶æ²¿ç€ Z è½´è´Ÿæ–¹å‘å»¶ä¼¸ (Three.js lookAt é»˜è®¤æ˜¯ Z è½´æ­£æ–¹å‘ï¼Œæˆ‘ä»¬éœ€è¦åå‘ï¼Œæˆ–è€…æ—‹è½¬å‡ ä½•ä½“)
                // è¿™é‡Œè®©åœ†æŸ±ä½“æ²¿ç€ X è½´æˆ– Z è½´æ’åˆ—
                tailGeo.rotateX(-Math.PI / 2); // æ—‹è½¬åï¼Œåœ†æŸ±ä½“æŒ‡å‘ Z è½´è´Ÿæ–¹å‘ï¼ˆå¦‚æœåŸç‚¹åœ¨é¡¶éƒ¨ï¼‰
                
                const tailMat = new THREE.MeshBasicMaterial({
                    map: textures.cometTail,
                    transparent: true,
                    opacity: 0.6,
                    side: THREE.DoubleSide,
                    depthWrite: false, // é˜²æ­¢é®æŒ¡é€æ˜ç‰©ä½“
                    blending: THREE.AdditiveBlending
                });
                
                const tailMesh = new THREE.Mesh(tailGeo, tailMat);
                // åˆå§‹ä¸æ·»åŠ åˆ° sceneï¼Œåœ¨ animate ä¸­æ›´æ–°
                scene.add(tailMesh);
                cometTails.push({
                    mesh: tailMesh,
                    target: planetMesh, // å½—å°¾è·Ÿéšçš„å½—æ˜Ÿ Mesh
                    maxLength: tailLength,
                    baseRadius: data.radius * 1.2
                });
            }

            // å¼‚æ­¥åŠ è½½çº¹ç†
            if (data.texture) {
                textureLoader.load(
                    data.texture,
                    (tex) => {
                        tex.colorSpace = THREE.SRGBColorSpace;
                        material.map = tex;
                        material.color.setHex(0xffffff); // çº¹ç†åŠ è½½æˆåŠŸåï¼Œæ¼«åå°„é¢œè‰²è®¾ä¸ºç™½è‰²
                        material.emissive.setHex(0x222222); 
                        material.needsUpdate = true;
                    },
                    undefined,
                    (err) => {
                        console.warn(`çº¹ç†åŠ è½½å¤±è´¥: ${data.name}ï¼Œä½¿ç”¨çº¯è‰²å›é€€`);
                    }
                );
            }
            
            // ç«æ˜Ÿç‰¹æ®Šå¤„ç†ï¼šæ·»åŠ  Normal Map
            if (data.name === "ç«æ˜Ÿ" && textures.marsNormal) {
                textureLoader.load(textures.marsNormal, (normTex) => {
                    material.normalMap = normTex;
                    material.normalScale.set(0.5, 0.5);
                    material.needsUpdate = true;
                }, undefined, (err) => console.warn("ç«æ˜Ÿæ³•çº¿è´´å›¾åŠ è½½å¤±è´¥"));
            }

            let geometry;
            // é’ˆå¯¹å“ˆé›·å½—æ˜Ÿç­‰ä¸è§„åˆ™å¤©ä½“ä½¿ç”¨ä¸åŒçš„ Geometry
            if (data.irregular) {
                // ä½¿ç”¨äºŒåé¢ä½“ä½œä¸ºåŸºç¡€ï¼Œçœ‹èµ·æ¥æ›´åƒä¸è§„åˆ™å²©çŸ³
                geometry = new THREE.IcosahedronGeometry(data.radius, 0);
                // æ‰°åŠ¨é¡¶ç‚¹ (å¯é€‰ï¼Œä½†è¿™é‡Œä¸ºäº†ç®€å•ç›´æ¥ç”¨ç¼©æ”¾)
            } else {
                geometry = new THREE.SphereGeometry(data.radius, 64, 64);
            }

            const planetMesh = new THREE.Mesh(geometry, material);
            
            // åº”ç”¨ä¸è§„åˆ™ç¼©æ”¾
            if (data.irregular && data.scale) {
                planetMesh.scale.set(data.scale[0], data.scale[1], data.scale[2]);
                // ä¿å­˜åŸå§‹éå‡åŒ€ç¼©æ”¾æ¯”ä¾‹ï¼Œä»¥ä¾¿çœŸå®æ¯”ä¾‹æ¨¡å¼ä¸‹æ¢å¤
                planetMesh.userData.originalScaleVector = new THREE.Vector3(data.scale[0], data.scale[1], data.scale[2]);
            } else {
                planetMesh.userData.originalScaleVector = new THREE.Vector3(1, 1, 1);
            }
            
            planetMesh.userData = { 
                name: data.name,
                description: data.description,
                details: data.details,
                link: data.link,
                realPhoto: data.realPhoto,
                type: data.name.includes("å½—æ˜Ÿ") ? "comet" : "planet"
            }; 
            planetMesh.castShadow = true;
            // ç¦ç”¨æ¥æ”¶é˜´å½±ï¼Œé˜²æ­¢è¢«å…¶ä»–æ˜Ÿä½“é®æŒ¡å˜é»‘
            planetMesh.receiveShadow = false; 
            planetMesh.position.set(0, 0, 0); 

            systemGroup.add(planetMesh);

            // åœ°çƒç‰¹æ®Šå¤„ç†ï¼šæ³•çº¿è´´å›¾ã€é«˜å…‰è´´å›¾ã€äº‘å±‚
            // å¿…é¡»æ”¾åœ¨ planetMesh å®šä¹‰ä¹‹å
            if (data.name === "åœ°çƒ") {
                if (textures.earthNormal) {
                    textureLoader.load(textures.earthNormal, (normalMap) => {
                        material.normalMap = normalMap;
                        material.normalScale.set(0.85, 0.85);
                        material.needsUpdate = true;
                    });
                }
                if (textures.earthSpecular) {
                    textureLoader.load(textures.earthSpecular, (specularMap) => {
                        material.roughnessMap = specularMap; 
                        material.roughness = 0.4;
                        material.metalness = 0.1;
                        material.needsUpdate = true;
                    });
                }

                // 2. æ·»åŠ äº‘å±‚ (ç­‰å¾…åŠ è½½å®Œæˆåå†åˆ›å»º)
                if (textures.earthClouds) {
                    textureLoader.load(textures.earthClouds, (cloudTex) => {
                        const cloudsGeo = new THREE.SphereGeometry(data.radius + 0.05, 64, 64);
                        const cloudsMat = new THREE.MeshLambertMaterial({
                            map: cloudTex,
                            transparent: true,
                            opacity: 0.8,
                            blending: THREE.AdditiveBlending,
                            side: THREE.DoubleSide 
                        });
                        const cloudsMesh = new THREE.Mesh(cloudsGeo, cloudsMat);
                        planetMesh.add(cloudsMesh); 
                        planetMesh.userData.clouds = cloudsMesh;
                    }, undefined, (err) => {
                        console.warn("äº‘å±‚çº¹ç†åŠ è½½å¤±è´¥");
                    });
                }
                
                // 3. æ·»åŠ å¤§æ°”å…‰æ™•
                const atmoGeo = new THREE.SphereGeometry(data.radius + 1.5, 64, 64);
                const atmoMat = new THREE.ShaderMaterial({
                    vertexShader: atmosphereVertexShader,
                    fragmentShader: atmosphereFragmentShader,
                    uniforms: {
                        glowColor: { value: new THREE.Color(0x0055aa) }, // è°ƒæš—è“è‰²å…‰æ™• (åŸ 0x0088ff)
                        coef: { value: 0.4 }, // é™ä½ç³»æ•°ï¼Œä½¿å…‰æ™•æ›´å†…æ•› (åŸ 0.6)
                        power: { value: 5.0 } // å¢åŠ æŒ‡æ•°ï¼Œä½¿è¾¹ç¼˜è¡°å‡æ›´å¿«ï¼Œæ›´æŸ”å’Œ (åŸ 4.0)
                    },
                    side: THREE.BackSide,
                    blending: THREE.AdditiveBlending,
                    transparent: true,
                    opacity: 0.6 // æ•´ä½“é€æ˜åº¦
                });
                const atmoMesh = new THREE.Mesh(atmoGeo, atmoMat);
                planetMesh.add(atmoMesh);
            }
            
            // é‡‘æ˜Ÿç‰¹æ®Šå¤„ç†ï¼šå¤§æ°”å…‰æ™•
            if (data.name === "é‡‘æ˜Ÿ") {
                const atmoGeo = new THREE.SphereGeometry(data.radius + 1.2, 64, 64);
                const atmoMat = new THREE.ShaderMaterial({
                    vertexShader: atmosphereVertexShader,
                    fragmentShader: atmosphereFragmentShader,
                    uniforms: {
                        glowColor: { value: new THREE.Color(0xcc9966) }, // è°ƒæš—é‡‘é»„è‰² (åŸ 0xffddaa)
                        coef: { value: 0.4 }, // (åŸ 0.5)
                        power: { value: 5.5 } // (åŸ 4.5)
                    },
                    side: THREE.BackSide,
                    blending: THREE.AdditiveBlending,
                    transparent: true,
                    opacity: 0.6
                });
                const atmoMesh = new THREE.Mesh(atmoGeo, atmoMat);
                planetMesh.add(atmoMesh);
            }

            // ç«æ˜Ÿç‰¹æ®Šå¤„ç†ï¼šç¨€è–„äº‘å±‚ + çº¢è‰²å¤§æ°”å…‰æ™•
            if (data.name === "ç«æ˜Ÿ") {
                // ç¨€è–„äº‘å±‚ (å¤ç”¨åœ°çƒäº‘å±‚çº¹ç†ï¼Œä½†é€æ˜åº¦æä½)
                if (textures.earthClouds) {
                    textureLoader.load(textures.earthClouds, (cloudTex) => {
                        const cloudsGeo = new THREE.SphereGeometry(data.radius + 0.03, 64, 64);
                        const cloudsMat = new THREE.MeshLambertMaterial({
                            map: cloudTex,
                            transparent: true,
                            opacity: 0.15, // å†æ¬¡é™ä½é€æ˜åº¦ (åŸ 0.2)
                            blending: THREE.AdditiveBlending,
                            side: THREE.DoubleSide 
                        });
                        const cloudsMesh = new THREE.Mesh(cloudsGeo, cloudsMat);
                        // ç¨å¾®è°ƒæ•´äº‘å±‚é¢œè‰²åçº¢å°˜
                        cloudsMesh.material.color = new THREE.Color(0xffcccc);
                        planetMesh.add(cloudsMesh); 
                        // ä¿å­˜å¼•ç”¨ä»¥ä¾¿æ—‹è½¬
                        if(!planetMesh.userData.clouds) planetMesh.userData.clouds = cloudsMesh;
                    });
                }
                
                // å¤§æ°”å…‰æ™•
                const atmoGeo = new THREE.SphereGeometry(data.radius + 0.8, 64, 64);
                const atmoMat = new THREE.ShaderMaterial({
                    vertexShader: atmosphereVertexShader,
                    fragmentShader: atmosphereFragmentShader,
                    uniforms: {
                        glowColor: { value: new THREE.Color(0xaa3300) }, // è°ƒæš—çº¢è‰² (åŸ 0xff4400)
                        coef: { value: 0.3 }, // é™ä½ç³»æ•° (åŸ 0.5)
                        power: { value: 6.0 } // å¢åŠ æŒ‡æ•° (åŸ 5.0)
                    },
                    side: THREE.BackSide,
                    blending: THREE.AdditiveBlending,
                    transparent: true,
                    opacity: 0.5
                });
                const atmoMesh = new THREE.Mesh(atmoGeo, atmoMat);
                planetMesh.add(atmoMesh);
            }
            
            // ...

            // è½¨é“çº¿ (å¢å¼ºå¯è§æ€§) - è½¨é“çº¿æ˜¯ç›¸å¯¹äº Scene çš„ï¼Œä¿æŒä¸å˜
            const trackShape = new THREE.EllipseCurve(
                -c, 0,            
                a, b, 
                0, 2 * Math.PI,  
                false,            
                0                 
            );
            const trackPoints = trackShape.getPoints(256); 
            const trackGeometry = new THREE.BufferGeometry().setFromPoints(trackPoints);
            const trackMaterial = new THREE.LineBasicMaterial({ 
                color: 0xAAAAAA, 
                transparent: true,
                opacity: 0.5,
                linewidth: 2     
            });
            const track = new THREE.LineLoop(trackGeometry, trackMaterial);
            track.rotation.x = -Math.PI / 2;
            // é˜²æ­¢åœ¨çœŸå®æ¯”ä¾‹æ¨¡å¼ä¸‹ï¼Œå½“ç›¸æœºé è¿‘è¡Œæ˜Ÿï¼ˆè¿œç¦»è½¨é“ä¸­å¿ƒï¼‰æ—¶ï¼Œå·¨å¤§çš„è½¨é“çº¿è¢«é”™è¯¯åœ°è§†é”¥ä½“å‰”é™¤å¯¼è‡´æ¶ˆå¤±
            track.frustumCulled = false;
            
            // å°†è½¨é“çº¿ä¹Ÿæ”¾å…¥ orbitGroupï¼Œè¿™æ ·è½¨é“çº¿ä¹Ÿä¼šè·Ÿç€å€¾æ–œ
            orbitGroup.add(track);
            // scene.add(track); // ç§»é™¤ç›´æ¥æ·»åŠ åˆ° scene
            if (data.name.includes("å½—æ˜Ÿ")) {
                cometTracks.push(track);
            } else {
                planetTracks.push(track); 
            }

            // åœŸæ˜Ÿç¯
            if (data.hasRing) {
                const ringGeo = new THREE.RingGeometry(data.radius * 1.4, data.radius * 2.2, 128);
                
                // é»˜è®¤ç¯æè´¨
                const ringMat = new THREE.MeshLambertMaterial({
                    color: 0xC0A070,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.8,
                    emissive: 0x222222, // ç¯ç¨å¾®äº®ä¸€ç‚¹
                    emissiveIntensity: 0.3
                });

                if (data.ringTexture) {
                     textureLoader.load(data.ringTexture, (ringTex) => {
                        // è°ƒæ•´çº¹ç†æ˜ å°„æ–¹å¼
                        const pos = ringGeo.attributes.position;
                        const v3 = new THREE.Vector3();
                        for (let i = 0; i < pos.count; i++){
                            v3.fromBufferAttribute(pos, i);
                            ringGeo.attributes.uv.setXY(i, v3.length() < (data.radius * 1.8) ? 0 : 1, 1);
                        }
                        ringGeo.attributes.uv.needsUpdate = true;

                        ringMat.map = ringTex;
                        ringMat.color.setHex(0xffffff);
                        ringMat.opacity = 0.9;
                        ringMat.needsUpdate = true;
                     });
                }
                
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.userData = { name: data.name + "å…‰ç¯" }; 
                ring.rotation.x = -Math.PI / 2; 
                ring.rotation.y = Math.PI / 10; 
                planetMesh.add(ring); 
            }

            // --- å¤„ç†å«æ˜Ÿ ---
            const activeMoons = [];
            if (data.moons) {
                data.moons.forEach(moonData => {
            // å«æ˜Ÿæè´¨
            const moonMat = new THREE.MeshLambertMaterial({
                color: moonData.color,
                emissive: 0x222222,
                emissiveIntensity: 0.5
            });

            if (moonData.texture) {
                textureLoader.load(moonData.texture, (tex) => {
                    tex.colorSpace = THREE.SRGBColorSpace;
                    moonMat.map = tex;
                    moonMat.color.setHex(0xffffff);
                    moonMat.emissive.setHex(0x222222);
                    moonMat.needsUpdate = true;
                }, undefined, (err) => {
                        // å¤±è´¥æ—¶ä¿æŒåŸè‰²
                        console.warn(`å«æ˜Ÿçº¹ç†åŠ è½½å¤±è´¥: ${moonData.name}`);
                });
            }

                    let moonGeo;
                    if (moonData.isSpacecraft) {
                        // ç®€å•çš„ ISS å½¢çŠ¶æ¨¡æ‹Ÿ (ä½¿ç”¨å‡ ä¸ªå‡ ä½•ä½“ç»„åˆï¼Œè¿™é‡Œç®€åŒ–ä¸ºä¸€ä¸ªé•¿æ–¹ä½“)
                        moonGeo = new THREE.BoxGeometry(moonData.radius * 4, moonData.radius, moonData.radius * 2);
                        moonMat.color.setHex(0xEEEEEE);
                        moonMat.emissive.setHex(0x555555);
                    } else if (moonData.irregular) {
                        moonGeo = new THREE.IcosahedronGeometry(moonData.radius, 0);
                    } else {
                        moonGeo = new THREE.SphereGeometry(moonData.radius, 32, 32);
                    }
                    
                    const moonMesh = new THREE.Mesh(moonGeo, moonMat);
                    
                    // ISS é™„åŠ ç»„ä»¶ (å¤ªé˜³èƒ½æ¿)
                    if (moonData.isSpacecraft) {
                        const panelGeo = new THREE.BoxGeometry(moonData.radius * 1, moonData.radius * 0.1, moonData.radius * 6);
                        const panelMat = new THREE.MeshLambertMaterial({ color: 0x3333AA, emissive: 0x111155 });
                        
                        const leftPanel = new THREE.Mesh(panelGeo, panelMat);
                        leftPanel.position.set(-moonData.radius * 2.5, 0, 0);
                        moonMesh.add(leftPanel);
                        
                        const rightPanel = new THREE.Mesh(panelGeo, panelMat);
                        rightPanel.position.set(moonData.radius * 2.5, 0, 0);
                        moonMesh.add(rightPanel);
                    }

                    // åº”ç”¨ä¸è§„åˆ™ç¼©æ”¾å¹¶ä¿å­˜åŸå§‹æ¯”ä¾‹
                    if (moonData.irregular && moonData.scale) {
                        moonMesh.scale.set(moonData.scale[0], moonData.scale[1], moonData.scale[2]);
                        moonMesh.userData.originalScaleVector = new THREE.Vector3(moonData.scale[0], moonData.scale[1], moonData.scale[2]);
                    } else {
                        moonMesh.userData.originalScaleVector = new THREE.Vector3(1, 1, 1);
                    }

                    moonMesh.castShadow = true;
                    // ç¦ç”¨æ¥æ”¶é˜´å½±ï¼Œé˜²æ­¢è¢«å…¶ä»–æ˜Ÿä½“é®æŒ¡å˜é»‘
                    moonMesh.receiveShadow = false;
                    
                    // æ·»åŠ å«æ˜Ÿè¯¦ç»†ä¿¡æ¯åˆ° userData
                    moonMesh.userData = { 
                        name: moonData.name, 
                        description: moonData.description || `è¿™æ˜¯${data.name}çš„ä¸€é¢—å«æ˜Ÿã€‚`,
                        details: moonData.details || { "è‹±æ–‡å": "Moon" },
                        link: moonData.link,
                        realPhoto: moonData.realPhoto,
                        type: "moon"
                    };
                    
                    systemGroup.add(moonMesh);

                    // å«æ˜Ÿè½¨é“æ˜¾ç¤º (ç›¸å¯¹äº SystemGroup)
                    const moonTrackShape = new THREE.EllipseCurve(
                        0, 0, moonData.distance, moonData.distance, 0, 2 * Math.PI, false, 0
                    );
                    const moonTrackPts = moonTrackShape.getPoints(64);
                    const moonTrackGeo = new THREE.BufferGeometry().setFromPoints(moonTrackPts);
                    const moonTrackMat = new THREE.LineBasicMaterial({ 
                        color: 0xAAAAAA, 
                        transparent: true, 
                        opacity: 0.5 
                    });
                    const moonTrack = new THREE.LineLoop(moonTrackGeo, moonTrackMat);
                    moonTrack.rotation.x = -Math.PI / 2; // é»˜è®¤æ°´å¹³
                    moonTrack.frustumCulled = false; // é˜²æ­¢è¿‘è·ç¦»è§‚å¯Ÿå«æ˜Ÿæ—¶è½¨é“æ¶ˆå¤±

                    // åˆ›å»ºå«æ˜Ÿè½¨é“å®¹å™¨ï¼Œå¤„ç†å€¾è§’
                    const moonOrbitGroup = new THREE.Group();
                    // åº”ç”¨å«æ˜Ÿå€¾è§’ (å¦‚æœæœ‰)
                    if (moonData.inclination) {
                        // è½¬æ¢ä¸ºå¼§åº¦
                        const inc = moonData.inclination * (Math.PI / 180);
                        // ç»• X è½´æˆ– Z è½´æ—‹è½¬ï¼Œæ¨¡æ‹Ÿç›¸å¯¹äºè¡Œæ˜Ÿèµ¤é“é¢çš„å€¾è§’
                        moonOrbitGroup.rotation.x = inc;
                        // éšæœºå‡äº¤ç‚¹ï¼Œè®©å¤šä¸ªå«æ˜Ÿè½¨é“é”™å¼€
                        moonOrbitGroup.rotation.y = Math.random() * Math.PI * 2;
                    }

                    moonOrbitGroup.add(moonTrack); // è½¨é“çº¿æ”¾å…¥å€¾æ–œå®¹å™¨
                    moonOrbitGroup.add(moonMesh);  // å«æ˜Ÿæœ¬èº«æ”¾å…¥å€¾æ–œå®¹å™¨ (æ³¨æ„ï¼šåé¢åŠ¨ç”»æ›´æ–°æ—¶åªéœ€æ›´æ–° x/z)

                    systemGroup.add(moonOrbitGroup); // æ”¾å…¥è¡Œæ˜Ÿç³»ç»Ÿ
                    moonTracks.push(moonTrack); // ä¿å­˜å¼•ç”¨

                    // è®¡ç®—å«æ˜Ÿåˆå§‹ä½ç½®
                    // ç¡®ä¿æœ‰ä¸€ä¸ªå›ºå®šçš„ J2000 å‡å€¼å¼‚å¸¸ï¼Œä»¥ä¾¿é‡ç½®æ—¶ä½¿ç”¨
                    const moonJ2000 = moonData.meanAnomalyJ2000 !== undefined ? moonData.meanAnomalyJ2000 : Math.random() * 360;
                    const initialMoonAngle = calculateMeanAnomaly(moonData.orbitalPeriod, moonJ2000, baseDate);

                    activeMoons.push({
                        mesh: moonMesh,
                        trackMesh: moonTrack, // ä¿å­˜å«æ˜Ÿè½¨é“çº¿å¼•ç”¨
                        group: moonOrbitGroup, // ä¿å­˜å®¹å™¨å¼•ç”¨ä»¥ä¾¿åŠ¨ç”»æ›´æ–°ï¼ˆå¦‚æœéœ€è¦å¤æ‚è®¡ç®—ï¼‰
                        distance: moonData.distance,
                        originalDistance: moonData.distance, // ä¿å­˜åŸå§‹è·ç¦»
                        speed: moonData.speed,
                        orbitalPeriod: moonData.orbitalPeriod,
                        meanAnomalyJ2000: moonJ2000, // ä¿å­˜ä»¥ä¾¿é‡ç½®
                        angle: initialMoonAngle
                    });
                });
            }

            // è®¡ç®—åˆå§‹ä½ç½®
            // ä½¿ç”¨å½“å‰æ—¶é—´ baseDate è®¡ç®—åˆå§‹å¹³è¿‘ç‚¹è§’
            const initialAngle = calculateMeanAnomaly(data.orbitalPeriod, data.meanAnomalyJ2000, baseDate);

            // ä¿å­˜å¼•ç”¨
            planets.push({
                mesh: planetMesh,
                systemGroup: systemGroup, // ä¸»è¦ç§»åŠ¨å¯¹è±¡
                trackMesh: track, // ä¿å­˜è½¨é“çº¿å¼•ç”¨
                speed: data.speed,
                orbitalPeriod: data.orbitalPeriod, // ä¿å­˜å‘¨æœŸ
                meanAnomalyJ2000: data.meanAnomalyJ2000, // ä¿å­˜J2000å¹³è¿‘ç‚¹è§’ (é‡è¦ï¼)
                rotateSpeed: data.rotateSpeed,
                distance: a, // åŠé•¿è½´
                originalDistance: a, // ä¿å­˜åŸå§‹è·ç¦»
                originalRadius: data.radius, // ä¿å­˜åŸå§‹åŠå¾„
                eccentricity: e,
                semiMinor: b,
                focusOffset: c,
                angle: initialAngle, // ä½¿ç”¨è®¡ç®—å‡ºçš„åˆå§‹è§’åº¦
                name: data.name,
                moons: activeMoons
            });
        }

        // ç”Ÿæˆæ‰€æœ‰è¡Œæ˜Ÿ
        planetData.forEach(data => createPlanet(data));


        // å¼ºåˆ¶éšè— loadingï¼Œé˜²æ­¢çº¹ç†åŠ è½½å¤±è´¥å¯¼è‡´å¡ä½
        // åœ¨ 2 ç§’åæ— è®ºæ˜¯å¦åŠ è½½å®Œæˆéƒ½æ˜¾ç¤ºåœºæ™¯
        setTimeout(() => {
            const loadingScreen = document.getElementById('loading');
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                loadingScreen.style.display = 'none';
                console.log("Loading timeout: Force hiding loading screen.");
            }
        }, 2000);


        // --- äº¤äº’é€»è¾‘ ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const tooltip = document.getElementById('tooltip');
        const planetInfoPanel = document.getElementById('planet-info-panel');
        const helpBtn = document.getElementById('help-btn');
        const helpPanel = document.getElementById('help-panel');
        const closeHelp = document.getElementById('close-help');
        const panelCloseBtn = document.getElementById('panel-close-btn');
        const panelCloseHint = document.getElementById('panel-close-hint');

        // å¸®åŠ©é¢æ¿é€»è¾‘
        helpBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            helpPanel.style.display = 'block';
        });

        closeHelp.addEventListener('click', () => {
            helpPanel.style.display = 'none';
        });

        // é˜»æ­¢ç‚¹å‡»å¸®åŠ©é¢æ¿æ—¶è§¦å‘èƒŒæ™¯ç‚¹å‡»
        helpPanel.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        
        // è¯¦æƒ…é¢æ¿å…³é—­æŒ‰é’®é€»è¾‘
        panelCloseBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            resetView();
        });

        // è¯¦æƒ…é¢æ¿åº•éƒ¨æç¤ºæ–‡å­—ç‚¹å‡»å…³é—­
        panelCloseHint.addEventListener('click', (e) => {
            e.stopPropagation();
            resetView();
        });
        
        // èšç„¦çŠ¶æ€
        let isFocused = false;
        let focusedObject = null; // å½“å‰èšç„¦çš„ Object3D (Planet Mesh)
        let focusedSystem = null; // å½“å‰èšç„¦çš„ System Group (å¦‚æœæœ‰)
        const originalCameraPosition = new THREE.Vector3();
        const originalControlsTarget = new THREE.Vector3();

        window.addEventListener('mousemove', (event) => {
            // å½’ä¸€åŒ–é¼ æ ‡åæ ‡
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // æ›´æ–° tooltip ä½ç½®è·Ÿéšé¼ æ ‡
            tooltip.style.left = event.clientX + 'px';
            tooltip.style.top = event.clientY + 'px';
        });

        // ç‚¹å‡»äº‹ä»¶
        window.addEventListener('click', (event) => {
            // å°„çº¿æ£€æµ‹
            raycaster.setFromCamera(mouse, camera);
            const targetObjects = [sun];
            planets.forEach(p => {
                targetObjects.push(p.mesh);
                // å«æ˜Ÿä¹Ÿæ”¯æŒç‚¹å‡»
                if (p.moons) {
                    p.moons.forEach(m => targetObjects.push(m.mesh));
                }
            });

            const intersects = raycaster.intersectObjects(targetObjects, false);

            if (intersects.length > 0) {
                const object = intersects[0].object;
                focusOnObject(object);
            }
        });

        // ESC é”®è¿”å›
        window.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                if (helpPanel.style.display === 'block') {
                    helpPanel.style.display = 'none';
                } else if (isFocused) {
                    resetView();
                }
            }
        });

        // èšç„¦åŠŸèƒ½
        const navigationList = []; // å¯¼èˆªåˆ—è¡¨ (å¤ªé˜³ + è¡Œæ˜Ÿ)
        // åˆå§‹åŒ–å¯¼èˆªåˆ—è¡¨ (åœ¨åˆ›å»ºå®Œæ‰€æœ‰å¯¹è±¡åå¡«å……)
        // æ³¨æ„ï¼šéœ€è¦åœ¨ init ä¹‹åè°ƒç”¨ï¼Œæˆ–è€…åœ¨è¿™é‡Œå…ˆå®šä¹‰å¼•ç”¨ï¼Œç­‰ mesh åˆ›å»ºå¥½å push
        // æˆ‘ä»¬åœ¨ animation loop å¼€å§‹å‰å¡«å……å®ƒ

        function initNavigationList() {
            navigationList.length = 0;
            navigationList.push(sun); // 0: å¤ªé˜³
            planets.forEach(p => navigationList.push(p.mesh)); // 1-8: è¡Œæ˜Ÿ
        }

        // ç»‘å®šå¯¼èˆªæŒ‰é’®äº‹ä»¶
        document.getElementById('prev-btn').addEventListener('click', (e) => {
            e.stopPropagation(); // é˜²æ­¢è§¦å‘ window click
            switchFocus(-1);
        });
        document.getElementById('next-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            switchFocus(1);
        });

        function switchFocus(offset) {
            if (!focusedObject) return;
            
            // æŸ¥æ‰¾å½“å‰å¯¹è±¡åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•
            let currentIndex = navigationList.indexOf(focusedObject);
            
            // å¦‚æœå½“å‰èšç„¦çš„æ˜¯å«æ˜Ÿï¼Œåˆ™æ‰¾ä¸åˆ°ç´¢å¼• (è¿”å› -1)ï¼Œæˆ‘ä»¬é»˜è®¤è·³åˆ°å®ƒæ‰€å±çš„è¡Œæ˜Ÿ
            if (currentIndex === -1) {
                // æ‰¾åˆ°çˆ¶çº§è¡Œæ˜Ÿ
                const parentPlanet = planets.find(p => p.moons && p.moons.some(m => m.mesh === focusedObject));
                if (parentPlanet) {
                    currentIndex = navigationList.indexOf(parentPlanet.mesh);
                } else {
                    currentIndex = 0; // é»˜è®¤å›å¤ªé˜³
                }
            }

            // è®¡ç®—æ–°ç´¢å¼• (å¾ªç¯)
            let newIndex = (currentIndex + offset) % navigationList.length;
            if (newIndex < 0) newIndex += navigationList.length;

            focusOnObject(navigationList[newIndex]);
        }

        function focusOnObject(object) {
            if (focusedObject !== object) { // åªæœ‰å½“ç›®æ ‡æ”¹å˜æ—¶æ‰æ›´æ–°
                isFocused = true;
                focusedObject = object;
                
                // ... (æŸ¥æ‰¾ SystemGroup é€»è¾‘ä¸å˜)
                focusedSystem = null;
                if (object === sun) {
                    focusedSystem = null; // å¤ªé˜³ä¸åŠ¨
                } else {
                    const planetEntry = planets.find(p => p.mesh === object);
                    if (planetEntry) {
                        focusedSystem = planetEntry.systemGroup;
                    } else {
                         const parentPlanet = planets.find(p => p.moons && p.moons.some(m => m.mesh === object));
                         if (parentPlanet) {
                            focusedSystem = parentPlanet.systemGroup; 
                         }
                    }
                }

                // ä¿å­˜å½“å‰è§†è§’ (ä»…åœ¨ç¬¬ä¸€æ¬¡èšç„¦æ—¶ä¿å­˜ï¼Œé¿å…è¿ç»­åˆ‡æ¢æ—¶è¦†ç›–)
                if (!originalCameraPosition.lengthSq()) { // ç®€å•åˆ¤æ–­æ˜¯å¦å·²ä¿å­˜
                    originalCameraPosition.copy(camera.position);
                    originalControlsTarget.copy(controls.target);
                }

                // æ˜¾ç¤ºé¢æ¿
                updateInfoPanel(object);
                planetInfoPanel.style.display = 'block';
                tooltip.style.display = 'none';

                // åŠ¨ç”»è®¡ç®— ...
                let radius = 0;
                if (object.geometry.parameters && object.geometry.parameters.radius) {
                    radius = object.geometry.parameters.radius;
                } else if (object.geometry.boundingBox) {
                    // å¦‚æœæœ‰ boundingBox (é€šå¸¸éœ€è¦ computeBoundingBox)
                    const box = object.geometry.boundingBox;
                    const size = new THREE.Vector3();
                    box.getSize(size);
                    radius = Math.max(size.x, size.y, size.z) / 2;
                } else {
                    // ç®€å•çš„å¤‡ç”¨æ–¹æ¡ˆï¼šè®¡ç®—å‡ ä½•ä½“çš„åŒ…å›´çƒ
                    object.geometry.computeBoundingSphere();
                    radius = object.geometry.boundingSphere.radius;
                }
                
                const offsetDistance = radius * 4 + (object === sun ? 50 : 10); 
                
                // å¼ºåˆ¶æ›´æ–°ä¸€ä¸‹ controls target
                const targetPos = new THREE.Vector3();
                object.getWorldPosition(targetPos);

                // ç›¸æœºç§»åŠ¨é€»è¾‘ï¼š
                // ä¿æŒå½“å‰ç›¸æœºç›¸å¯¹äºç›®æ ‡çš„è§’åº¦ï¼Œåªæ˜¯æ‹‰è¿‘è·ç¦»
                // æˆ–è€…ï¼Œå¦‚æœæ˜¯åˆ‡æ¢ï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªå›ºå®šçš„ä¿¯è§†è§’
                const direction = new THREE.Vector3().subVectors(camera.position, targetPos).normalize();
                if (direction.lengthSq() < 0.1) direction.set(0, 0, 1); // é˜²æ­¢é‡åˆ
                
                const newCameraPos = targetPos.clone().add(direction.multiplyScalar(offsetDistance));

                new TWEEN.Tween(camera.position)
                    .to(newCameraPos, 1000) // åŠ å¿«ä¸€ç‚¹åˆ‡æ¢é€Ÿåº¦
                    .easing(TWEEN.Easing.Cubic.Out)
                    .start();

                new TWEEN.Tween(controls.target)
                    .to(targetPos, 1000)
                    .easing(TWEEN.Easing.Cubic.Out)
                    .start();
            }
        }

        // é‡ç½®è§†å›¾
        function resetView() {
            if (!isFocused) return;

            // éšè—é¢æ¿
            planetInfoPanel.style.display = 'none';

            // Tween ç›¸æœºå›åŸä½
            // ... (é€»è¾‘ä¸å˜)
            new TWEEN.Tween(camera.position)
                .to(originalCameraPosition, 1500)
                .easing(TWEEN.Easing.Cubic.InOut)
                .start();

            new TWEEN.Tween(controls.target)
                .to(originalControlsTarget, 1500)
                .easing(TWEEN.Easing.Cubic.InOut)
                .onComplete(() => {
                    isFocused = false;
                    focusedObject = null;
                    focusedSystem = null;
                    // æ¸…ç©ºä¿å­˜çš„ä½ç½®ï¼Œä»¥ä¾¿ä¸‹æ¬¡èšç„¦é‡æ–°ä¿å­˜
                    originalCameraPosition.set(0,0,0); 
                })
                .start();
        }
        
            // 3D é¢„è§ˆç›¸å…³å˜é‡
        let previewRenderer, previewScene, previewCamera, previewObject, previewId;
        const previewContainer = document.getElementById('planet-preview-container');

        function initPreview() {
            if (previewRenderer) return; // é˜²æ­¢é‡å¤åˆå§‹åŒ–

            const width = previewContainer.clientWidth || 280; // Fallback width
            const height = previewContainer.clientHeight || 200;
            
            previewScene = new THREE.Scene();
            
            previewCamera = new THREE.PerspectiveCamera(35, width / height, 0.1, 1000);
            previewCamera.position.z = 4;
            
            previewRenderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            previewRenderer.setSize(width, height);
            previewRenderer.setPixelRatio(window.devicePixelRatio);
            // æ³¨æ„ï¼šä¸å†ç›´æ¥ appendChildï¼Œå› ä¸ºç°åœ¨å®¹å™¨é‡Œå¯èƒ½æœ‰ img æ ‡ç­¾
            // previewContainer.appendChild(previewRenderer.domElement); 
            
            // ç¡®ä¿ canvas åœ¨ img åé¢æˆ–è€…å‰é¢ï¼Œé€šè¿‡ display æ§åˆ¶
            previewRenderer.domElement.id = "planet-preview-canvas";
            previewContainer.appendChild(previewRenderer.domElement);

            // é¢„è§ˆåœºæ™¯å…‰ç…§
            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            previewScene.add(ambient);
            const dirLight = new THREE.DirectionalLight(0xffffff, 2.0);
            dirLight.position.set(5, 3, 10);
            previewScene.add(dirLight);
        }

        function updatePreview(targetObject) {
            initPreview(); // ç¡®ä¿åˆå§‹åŒ–
            
            // æ¸…ç†æ—§å¯¹è±¡
            if (previewObject) {
                previewScene.remove(previewObject);
                if (previewObject.geometry) previewObject.geometry.dispose();
                // æè´¨ä¸ disposeï¼Œå› ä¸ºå¯èƒ½å…±äº«
            }
            
            // åœæ­¢æ—§åŠ¨ç”»
            if (previewId) cancelAnimationFrame(previewId);

            // åˆ›å»ºæ–°å¯¹è±¡
            // ç»Ÿä¸€ä½¿ç”¨ SphereGeometryï¼Œä¸è®ºç›®æ ‡æ˜¯ä»€ä¹ˆï¼ˆç¡®ä¿æ˜¯çƒä½“é¢„è§ˆï¼‰
            // é™¤éæ˜¯å“ˆé›·å½—æ˜Ÿç­‰ä¸è§„åˆ™ä½“ï¼Œé¢„è§ˆä¹Ÿåº”è¯¥æ˜¯ä¸è§„åˆ™çš„ï¼Ÿ
            // ç®€å•èµ·è§ï¼Œå¦‚æœç›®æ ‡æ˜¯ä¸è§„åˆ™çš„ï¼Œæˆ‘ä»¬ä¹Ÿå°è¯•å¤åˆ¶ geometry
            let geometry;
            if (targetObject.userData && targetObject.userData.irregular) {
                 // å¤ç”¨ä¸è§„åˆ™ geometry (å…‹éš†)
                 geometry = targetObject.geometry.clone();
            } else {
                 geometry = new THREE.SphereGeometry(1.2, 64, 64);
            }
            
            // å°è¯•å¤ç”¨æè´¨çš„ map
            let material;
            if (targetObject.material) {
                material = targetObject.material.clone();
                
                // åªæœ‰æ ‡å‡†æè´¨æˆ–Lambertæè´¨æ‰æ”¯æŒ emissive
                if (material.type !== 'MeshBasicMaterial') {
                    // ç¡®ä¿é¢„è§ˆæ—¶æè´¨æ˜¯äº®çš„
                    material.emissiveIntensity = 0.5; 
                    material.emissive.setHex(0x222222);
                }
            } else {
                material = new THREE.MeshLambertMaterial({ color: 0x888888 });
            }

            previewObject = new THREE.Mesh(geometry, material);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å…‰ç¯ (æ¯”å¦‚åœŸæ˜Ÿ)
            // åœ¨ targetObject.children ä¸­æŸ¥æ‰¾ Mesh ä¸” geometry æ˜¯ RingGeometry çš„
            targetObject.children.forEach(child => {
                 // ç®€å•çš„ç‰¹å¾åˆ¤æ–­
                 if (child.isMesh && child.geometry && child.geometry.type.includes("Ring")) {
                     const ringGeo = child.geometry.clone();
                     const ringMat = child.material.clone();
                     const ring = new THREE.Mesh(ringGeo, ringMat);
                     
                     // è°ƒæ•´ç¯çš„æ¯”ä¾‹ä»¥é€‚åº”é¢„è§ˆçƒä½“ (é¢„è§ˆçƒä½“åŠå¾„ 1.2)
                     // åŸçƒä½“åŠå¾„
                     const originalRadius = targetObject.geometry.parameters ? targetObject.geometry.parameters.radius : 1.2;
                     const scale = 1.2 / originalRadius;
                     
                     ring.scale.set(scale, scale, scale);
                     ring.rotation.copy(child.rotation);
                     previewObject.add(ring);
                 }
                 // åœ°çƒäº‘å±‚
                 if (child.userData && child === targetObject.userData.clouds) {
                      const cloudGeo = new THREE.SphereGeometry(1.22, 64, 64);
                      const cloudMat = child.material.clone();
                      const clouds = new THREE.Mesh(cloudGeo, cloudMat);
                      previewObject.add(clouds);
                 }
            });

            previewScene.add(previewObject);
            
            function animatePreview() {
                previewId = requestAnimationFrame(animatePreview);
                if (previewObject) {
                    previewObject.rotation.y += 0.01;
                }
                previewRenderer.render(previewScene, previewCamera);
            }
            animatePreview();
        }
        
        // æ›´æ–°é¢æ¿å†…å®¹
        function updateInfoPanel(object) {
            const data = object.userData;
            document.getElementById('panel-name').innerText = data.name || "æœªçŸ¥æ˜Ÿçƒ";
            document.getElementById('panel-desc').innerText = data.description || "æš‚æ— è¯¦ç»†æè¿°ã€‚";
            
            const statsDiv = document.getElementById('panel-stats');
            statsDiv.innerHTML = ''; 
            
            if (data.details) {
                const table = document.createElement('table');
                for (const [key, value] of Object.entries(data.details)) {
                    const tr = document.createElement('tr');
                    const tdKey = document.createElement('td');
                    tdKey.innerText = key;
                    const tdValue = document.createElement('td');
                    tdValue.innerText = value;
                    tr.appendChild(tdKey);
                    tr.appendChild(tdValue);
                    table.appendChild(tr);
                }
                statsDiv.appendChild(table);
            }

            // æ·»åŠ ç»´åŸºç™¾ç§‘é“¾æ¥
            if (data.link) {
                const linkDiv = document.createElement('div');
                linkDiv.style.marginTop = '15px';
                linkDiv.style.textAlign = 'center';
                const link = document.createElement('a');
                link.href = data.link;
                link.target = '_blank';
                link.innerText = 'æŸ¥çœ‹ç»´åŸºç™¾ç§‘è¯¦æƒ…';
                link.style.color = '#4FD0E7';
                link.style.textDecoration = 'none';
                link.style.fontSize = '14px';
                link.onmouseover = () => link.style.textDecoration = 'underline';
                link.onmouseout = () => link.style.textDecoration = 'none';
                linkDiv.appendChild(link);
                statsDiv.appendChild(linkDiv);
            }

            // å¤„ç†é¢„è§ˆå›¾ vs 3Dæ¨¡å‹
            const photoImg = document.getElementById('planet-photo-display');
            
            if (data.realPhoto) {
                // æ˜¾ç¤ºçœŸå®ç…§ç‰‡
                photoImg.src = data.realPhoto;
                photoImg.style.display = 'block';
                
                // éšè— 3D canvas (å¦‚æœå·²åˆå§‹åŒ–)
                if (previewRenderer) {
                    previewRenderer.domElement.style.display = 'none';
                }
                // åœæ­¢åŠ¨ç”»
                if (previewId) cancelAnimationFrame(previewId);
            } else {
                // æ˜¾ç¤º 3D æ¨¡å‹
                photoImg.style.display = 'none';
                if (previewRenderer) {
                    previewRenderer.domElement.style.display = 'block';
                }
                updatePreview(object);
            }
        }
        
        // åˆå§‹åŒ–å¯¼èˆªåˆ—è¡¨
        initNavigationList();


        const clock = new THREE.Clock();
        let simulatedDays = 0;
        let timeSpeed = 1.0; // é»˜è®¤ 1.0x
        let isPaused = false;
        let lastSpeed = 1.0; // è®°å½•æš‚åœå‰çš„é€Ÿåº¦
        
        const dateText = document.getElementById('date-text');
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        
        // æ—¥æœŸé€‰æ‹©å™¨ç›¸å…³å…ƒç´ 
        const timeDisplay = document.getElementById('time-display');
        const dateModal = document.getElementById('date-picker-modal');
        const inputYear = document.getElementById('input-year');
        const inputMonth = document.getElementById('input-month');
        const inputDay = document.getElementById('input-day');
        const dateConfirm = document.getElementById('date-confirm');
        const dateCancel = document.getElementById('date-cancel');

        // è½¨è¿¹å¼€å…³é€»è¾‘
        document.getElementById('toggle-planet-tracks').addEventListener('change', (e) => {
            const visible = e.target.checked;
            planetTracks.forEach(track => track.visible = visible);
        });

        document.getElementById('toggle-comet-tracks').addEventListener('change', (e) => {
            const visible = e.target.checked;
            cometTracks.forEach(track => track.visible = visible);
        });

        document.getElementById('toggle-moon-tracks').addEventListener('change', (e) => {
            const visible = e.target.checked;
            moonTracks.forEach(track => track.visible = visible);
        });
        
        // const baseDate = new Date(); // ç§»åŠ¨åˆ°äº†ä¸Šé¢ "åˆå§‹ä½ç½®è®¡ç®—ç›¸å…³" åŒºåŸŸ

        // é€šç”¨ï¼šæ›´æ–°ç³»ç»Ÿåˆ°æŒ‡å®šæ—¥æœŸå¹¶æš‚åœ
        function jumpToDate(targetDate) {
            // 1. æ›´æ–°æ—¶é—´å˜é‡
            simulatedDays = 0;
            baseDate.setTime(targetDate.getTime()); // æ›´æ–°åŸºå‡†æ—¶é—´
            
            // 2. æ›´æ–°æ˜¾ç¤º
            dateText.innerText = targetDate.toISOString().split('T')[0];
            
            // 3. æš‚åœç³»ç»Ÿ (ä½†ä¿æŒå½“å‰é€Ÿåº¦æ»‘å—ä½ç½®ï¼Œè¿˜æ˜¯é‡ç½®ï¼Ÿéœ€æ±‚æœªæ˜ç¡®è¯´è¦é‡ç½®æ»‘å—ï¼Œä½†è¯´ç³»ç»Ÿæš‚åœ)
            // "å›åˆ°ä»Šå¤©"éœ€æ±‚æ˜ç¡®è¯´äº†æ—¶é—´è½´å½’ä½ï¼Œä½†"è°ƒèŠ‚æ—¶é—´"åªè¯´äº†æš‚åœã€‚
            // ä¸ºäº†ä½“éªŒä¸€è‡´ï¼Œæˆ‘ä»¬åªæš‚åœï¼Œä¸å¼ºåˆ¶é‡ç½®æ»‘å—åˆ° 1.0xï¼Œé™¤éæ˜¯ resetBtn è§¦å‘çš„ã€‚
            isPaused = true;
            pauseBtn.innerText = "â–¶ï¸ Play";
            pauseBtn.style.background = "rgba(200, 50, 50, 0.6)";
            timeSpeed = 0; // æš‚åœ

            // 4. é‡ç½®æ‰€æœ‰å¤©ä½“ä½ç½®
            planets.forEach(p => {
                // é‡æ–°è®¡ç®—è¡Œæ˜Ÿä½ç½®
                if (p.orbitalPeriod) {
                    p.angle = calculateMeanAnomaly(p.orbitalPeriod, p.meanAnomalyJ2000, targetDate);
                }
                
                // ç«‹å³æ›´æ–°ä½ç½®æ˜¾ç¤º
                let M = p.angle;
                let e = p.eccentricity;
                let E = M;
                if (e > 0.001) {
                    for (let i = 0; i < 5; i++) {
                         E = E - (E - e * Math.sin(E) - M) / (1 - e * Math.cos(E));
                    }
                }
                p.systemGroup.position.x = p.distance * Math.cos(E) - p.focusOffset;
                p.systemGroup.position.z = p.semiMinor * Math.sin(E);

                // é‡æ–°è®¡ç®—å«æ˜Ÿä½ç½®
                if (p.moons) {
                    p.moons.forEach(m => {
                        if (m.orbitalPeriod) {
                             m.angle = calculateMeanAnomaly(m.orbitalPeriod, m.meanAnomalyJ2000, targetDate);
                             m.mesh.position.x = Math.cos(m.angle) * m.distance;
                             m.mesh.position.z = Math.sin(m.angle) * m.distance;
                        }
                    });
                }
            });
        }

        // ç›‘å¬æ»‘å—å˜åŒ–
        speedSlider.addEventListener('input', (e) => {
            // å¯¹æ•°åˆ»åº¦æ˜ å°„
            const sliderVal = parseFloat(e.target.value);
            const minSpeed = 0.1;
            const maxSpeed = 365;
            // formula: speed = min * (max/min)^(val/maxVal)
            const val = minSpeed * Math.pow(maxSpeed / minSpeed, sliderVal / 1000);
            
            // æ˜¾ç¤ºä¼˜åŒ–
            let displayVal;
            if (val < 10) displayVal = val.toFixed(1);
            else displayVal = Math.round(val);
            
            speedValue.innerText = displayVal + 'x';
            
            if (!isPaused) {
                timeSpeed = val;
            }
            lastSpeed = val; // æ— è®ºæ˜¯å¦æš‚åœï¼Œéƒ½æ›´æ–°è®°å¿†çš„é€Ÿåº¦
        });

        // æš‚åœæŒ‰é’®é€»è¾‘
        pauseBtn.addEventListener('click', () => {
            isPaused = !isPaused;
            if (isPaused) {
                timeSpeed = 0;
                pauseBtn.innerText = "â–¶ï¸ Play";
                pauseBtn.style.background = "rgba(200, 50, 50, 0.6)";
            } else {
                timeSpeed = lastSpeed;
                pauseBtn.innerText = "â¸ï¸ Pause";
                pauseBtn.style.background = "rgba(255, 255, 255, 0.2)";
            }
        });

        // å›åˆ°ä»Šå¤©æŒ‰é’®é€»è¾‘
        resetBtn.addEventListener('click', () => {
            const now = new Date();
            jumpToDate(now);
            
            // "å›åˆ°ä»Šå¤©" çš„ç‰¹æ®Šé€»è¾‘ï¼šé‡ç½®é€Ÿåº¦ä¸º 1x
            speedSlider.value = 281;
            speedValue.innerText = "1.0x";
            lastSpeed = 1.0;
        });
        
        // --- æ—¥æœŸé€‰æ‹©å™¨é€»è¾‘ ---
        
        // 1. æ‰“å¼€é€‰æ‹©å™¨
        timeDisplay.addEventListener('click', (e) => {
            e.stopPropagation();
            // è·å–å½“å‰æ¨¡æ‹Ÿæ—¥æœŸ (baseDate + simulatedDays)
            // æ³¨æ„ï¼šå› ä¸ºæˆ‘ä»¬åœ¨ animate ä¸­æ˜¯ä¸€ç›´ç´¯åŠ  simulatedDaysï¼Œ
            // è€Œ jumpToDate ä¼šé‡ç½® simulatedDays=0 å¹¶æ›´æ–° baseDateã€‚
            // æ‰€ä»¥å½“å‰æ˜¾ç¤ºçš„æ—¥æœŸåº”è¯¥æ˜¯:
            const currentDate = new Date(baseDate.getTime() + simulatedDays * 24 * 60 * 60 * 1000);
            
            inputYear.value = currentDate.getFullYear();
            inputMonth.value = currentDate.getMonth() + 1;
            inputDay.value = currentDate.getDate();
            
            dateModal.style.display = 'block';
            
            // æ‰“å¼€æ—¶è‡ªåŠ¨æš‚åœ
            if (!isPaused) {
                pauseBtn.click();
            }
        });
        
        // 2. å…³é—­é€‰æ‹©å™¨
        dateCancel.addEventListener('click', (e) => {
            e.stopPropagation();
            dateModal.style.display = 'none';
        });
        
        // 3. ç¡®å®šé€‰æ‹©
        dateConfirm.addEventListener('click', (e) => {
            e.stopPropagation();
            const y = parseInt(inputYear.value);
            const m = parseInt(inputMonth.value) - 1; // JS Month is 0-11
            const d = parseInt(inputDay.value);
            
            const newDate = new Date(y, m, d);
            // ç®€å•çš„æ—¥æœŸæœ‰æ•ˆæ€§ä¿®æ­£ (ä¾‹å¦‚ 2æœˆ30æ—¥ -> 3æœˆ2æ—¥)
            // Dateæ„é€ å‡½æ•°ä¼šè‡ªåŠ¨å¤„ç†æº¢å‡ºï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–éªŒè¯
            
            jumpToDate(newDate);
            dateModal.style.display = 'none';
        });
        
        // 4. é˜»æ­¢æ¨¡æ€æ¡†ç‚¹å‡»å†’æ³¡
        dateModal.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        
        // 5. æ»šè½®æ§åˆ¶è¾“å…¥æ¡† (é€šç”¨å¤„ç†)
        function handleWheelInput(e) {
            e.preventDefault();
            const input = e.target;
            const step = 1;
            const delta = e.deltaY < 0 ? step : -step;
            
            let val = parseInt(input.value) + delta;
            
            // è¾¹ç•Œæ£€æŸ¥
            const min = parseInt(input.min);
            const max = parseInt(input.max);
            
            if (val < min) val = min;
            if (val > max) val = max;
            
            input.value = val;
        }
        
        [inputYear, inputMonth, inputDay].forEach(input => {
            input.addEventListener('wheel', handleWheelInput, { passive: false });
        });

        // çœŸå®æ¯”ä¾‹ç›¸å…³æ•°æ®å’Œé€»è¾‘
        const realScaleData = {
            "æ°´æ˜Ÿ": { au: 0.39, radiusRatio: 0.38 },
            "é‡‘æ˜Ÿ": { au: 0.72, radiusRatio: 0.95 },
            "åœ°çƒ": { au: 1.00, radiusRatio: 1.00 },
            "ç«æ˜Ÿ": { au: 1.52, radiusRatio: 0.53 },
            // å›½é™…ç©ºé—´ç«™ (é«˜åº¦ä»…400kmï¼Œçº¦ä¸ºåœ°çƒåŠå¾„çš„1/16ï¼Œéå¸¸è´´è¿‘)
            // çœŸå®æ¯”ä¾‹ä¸‹å‡ ä¹è´´åœ¨åœ°çƒè¡¨é¢ï¼Œä¸ºäº†å¯è§æ€§æˆ‘ä»¬ç¨å¾®æ”¾å®½ä¸€ç‚¹ç‚¹
            "å›½é™…ç©ºé—´ç«™": { au: 1.0005, radiusRatio: 0.01 }, 
            // è°·ç¥æ˜Ÿ
            "è°·ç¥æ˜Ÿ": { au: 2.77, radiusRatio: 0.074 },
            "æœ¨æ˜Ÿ": { au: 5.20, radiusRatio: 11.2 },
            "åœŸæ˜Ÿ": { au: 9.58, radiusRatio: 9.45 },
            "å¤©ç‹æ˜Ÿ": { au: 19.20, radiusRatio: 4.00 },
            "æµ·ç‹æ˜Ÿ": { au: 30.05, radiusRatio: 3.88 },
            "å†¥ç‹æ˜Ÿ": { au: 39.48, radiusRatio: 0.18 },
            // å“ˆé›·å½—æ˜ŸåŠå¾„æå° (5.5km / 6371km â‰ˆ 0.00086)
            // çœŸå®æ¯”ä¾‹ä¸‹å‡ ä¹ä¸å¯è§ï¼Œæˆ‘ä»¬ç»™å®ƒä¸€ä¸ªæœ€å°å¯è§å€¼ 0.05 (çº¦ä¸ºåœ°çƒçš„ 1/20) æ–¹ä¾¿è§‚å¯Ÿ
            "å“ˆé›·å½—æ˜Ÿ": { au: 17.8, radiusRatio: 0.05 }
        };

        // åˆ‡æ¢é€»è¾‘
        const toggleRealScale = document.getElementById('toggle-real-scale');
        
        // ç¡®ä¿åˆå§‹åŒ–æ—¶çŠ¶æ€ä¸€è‡´ (æœªå‹¾é€‰)
        toggleRealScale.checked = false;
        
        toggleRealScale.addEventListener('change', (e) => {
            const isReal = e.target.checked;
            updatePlanetScales(isReal);
        });

        function updatePlanetScales(isReal) {
            planets.forEach((p, index) => {
                const realData = realScaleData[p.name];
                
                // 1. æ›´æ–°è·ç¦»
                let newDistance, newScale;
                if (isReal && realData) {
                    newDistance = 200 * realData.au;
                    // çœŸå®æ¯”ä¾‹ä¸‹ï¼Œåœ°çƒåŠå¾„è®¾ä¸º 2 (åŸ 10)ï¼Œå…¶ä»–æŒ‰æ¯”ä¾‹
                    // åŸå¤§å°æ˜¯è§†è§‰ä¼˜åŒ–çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ EarthBaseRadius = 2
                    const earthBaseRadius = 2;
                    // è®¡ç®—ç›®æ ‡åŠå¾„
                    const targetRadius = earthBaseRadius * realData.radiusRatio;
                    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ (ç›¸å¯¹äºåŸå§‹ Geometry çš„ radius)
                    // åŸå§‹ radius å­˜å‚¨åœ¨ p.originalRadius ä¸­ (éœ€è¦åœ¨ createPlanet ä¸­ä¿å­˜)
                    const scaleFactor = targetRadius / p.originalRadius;
                    newScale = scaleFactor;
                } else {
                    // æ¢å¤é»˜è®¤
                    newDistance = p.originalDistance;
                    newScale = 1.0; // æ¢å¤åŸå§‹ geometry å¤§å°
                }

                // æ›´æ–°è½¨é“å‚æ•°
                p.distance = newDistance;
                p.semiMinor = newDistance * Math.sqrt(1 - p.eccentricity * p.eccentricity);
                p.focusOffset = newDistance * p.eccentricity;

                // æ›´æ–°æ˜Ÿçƒ Mesh å¤§å°
                if (p.mesh.userData.originalScaleVector) {
                    const orig = p.mesh.userData.originalScaleVector;
                    p.mesh.scale.copy(orig).multiplyScalar(newScale);
                } else {
                    p.mesh.scale.set(newScale, newScale, newScale);
                }
                
                // æ›´æ–°å«æ˜Ÿç³»ç»Ÿ (è·ç¦»å’Œå¤§å°ä¹Ÿéƒ½æŒ‰è¡Œæ˜Ÿçš„ç¼©æ”¾æ¯”ä¾‹è°ƒæ•´ï¼Œä¿æŒç›¸å¯¹ä¸€è‡´)
                if (p.moons) {
                    p.moons.forEach(m => {
                        // å«æ˜Ÿå¤§å°è·Ÿéšè¡Œæ˜Ÿç¼©æ”¾ï¼ŒåŒæ—¶ä¿æŒè‡ªèº«å½¢çŠ¶
                        if (m.mesh.userData.originalScaleVector) {
                            const moonOrig = m.mesh.userData.originalScaleVector;
                            m.mesh.scale.copy(moonOrig).multiplyScalar(newScale);
                        } else {
                            m.mesh.scale.set(newScale, newScale, newScale);
                        }
                        
                        // å«æ˜Ÿè½¨é“åŠå¾„ä¹Ÿè·Ÿéšç¼©æ”¾ï¼Œé˜²æ­¢ç©¿æ¨¡
                        m.distance = m.originalDistance * (isReal ? newScale : 1.0); // éœ€è¦ä¿å­˜ m.originalDistance
                        
                        // æ›´æ–°å«æ˜Ÿè½¨é“çº¿ Geometry
                         // è·å–å«æ˜Ÿè½¨é“çº¿
                        // æ³¨æ„ï¼šæˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä¿å­˜å«æ˜Ÿè½¨é“çº¿çš„å¼•ç”¨åœ¨ m ä¸­ï¼Œä½† moonTracks é‡Œæœ‰
                        // æˆ–è€…æˆ‘ä»¬åœ¨ createPlanet æ—¶ä¿å­˜ä¸€ä¸‹å¼•ç”¨åˆ° m å¯¹è±¡é‡Œä¼šæ›´æ–¹ä¾¿
                        if (m.trackMesh) {
                             const curve = new THREE.EllipseCurve(0, 0, m.distance, m.distance, 0, 2 * Math.PI);
                             const points = curve.getPoints(64);
                             m.trackMesh.geometry.setFromPoints(points);
                        }
                    });
                }

                // æ›´æ–°è¡Œæ˜Ÿè½¨é“çº¿ Geometry
                // planetTracks æ•°ç»„é‡Œçš„é¡ºåºå’Œ planets ä¸€è‡´å—ï¼ŸcreatePlanet æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œåº”è¯¥ä¸€è‡´
                // ä¸ºé˜²ä¸‡ä¸€ï¼Œæˆ‘ä»¬åœ¨ createPlanet é‡ŒæŠŠ track æŒ‚åˆ° planet å¯¹è±¡ä¸Š
                if (p.trackMesh) {
                    const c = p.focusOffset;
                    const curve = new THREE.EllipseCurve(-c, 0, p.distance, p.semiMinor, 0, 2 * Math.PI);
                    const points = curve.getPoints(256);
                    p.trackMesh.geometry.setFromPoints(points);
                }
            });
            
            // 2. æ›´æ–°å°è¡Œæ˜Ÿå¸¦
            updateBelt(asteroidBeltMesh, 200, 250, 2.2, 3.2, isReal);
            
            // 3. æ›´æ–°æŸ¯ä¼Šä¼¯å¸¦
            // é»˜è®¤: 1100-1600
            // çœŸå®: 30-50 AU (6000 - 10000)
            updateBelt(kuiperBeltMesh, 1100, 1600, 30, 50, isReal);
        }
        
        // é€šç”¨å¸¦çŠ¶ç»“æ„æ›´æ–°å‡½æ•°
        function updateBelt(mesh, origInner, origOuter, realInnerAU, realOuterAU, isReal) {
            if (!mesh) return;
            
            const positions = mesh.geometry.attributes.position.array;
            const count = positions.length / 3;
            const originalPos = mesh.userData.originalGeometry.attributes.position.array;
            
            const origWidth = origOuter - origInner;
            
            // çœŸå®æ¨¡å¼è·ç¦»
            const realInner = 200 * realInnerAU;
            const realOuter = 200 * realOuterAU;
            
            const targetInner = isReal ? realInner : origInner;
            const targetOuter = isReal ? realOuter : origOuter;
            const targetWidth = targetOuter - targetInner;
            
            // ç¼©æ”¾ç²’å­å¤§å°
            const newSize = isReal ? (mesh === asteroidBeltMesh ? 0.8 : 1.5) : (mesh === asteroidBeltMesh ? 1.5 : 2.0);
            mesh.material.size = newSize;
            
            for(let i=0; i<count; i++) {
                const ix = i*3;
                const iy = i*3+1;
                const iz = i*3+2;
                
                const ox = originalPos[ix];
                const oy = originalPos[iy];
                const oz = originalPos[iz];
                
                const oldR = Math.sqrt(ox*ox + oz*oz);
                const angle = Math.atan2(oz, ox);
                
                const normalizedR = (oldR - origInner) / origWidth;
                // ç®€å•çš„ clamp é˜²æ­¢è¶Šç•Œ (éšæœºç”Ÿæˆçš„åŸå§‹æ•°æ®å¯èƒ½ç¨å¾®è¶…å‡ºèŒƒå›´)
                const clampedNormR = Math.max(0, Math.min(1, normalizedR));
                
                const newR = targetInner + clampedNormR * targetWidth;
                
                positions[ix] = newR * Math.cos(angle);
                positions[iz] = newR * Math.sin(angle);
                positions[iy] = oy * (isReal ? (mesh === asteroidBeltMesh ? 2.0 : 10.0) : 1.0); 
            }
            mesh.geometry.attributes.position.needsUpdate = true;
        }


        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            let currentDate;

            // æ›´æ–°æ¨¡æ‹Ÿæ—¶é—´ (åŸºäº timeSpeed å’ŒçœŸå®æ—¶é—´ delta)
            // 1x é€Ÿåº¦ = 1ç§’æµé€1å¤©
            simulatedDays += delta * timeSpeed; 
            currentDate = new Date(baseDate.getTime() + simulatedDays * 24 * 60 * 60 * 1000);
            dateText.innerText = currentDate.toISOString().split('T')[0];

            // é”®ç›˜æ§åˆ¶ç›¸æœºæ›´æ–°
            updateCameraPosition();

            // å¤ªé˜³è‡ªè½¬
            sun.rotation.y += 0.002 * delta * timeSpeed;
            
            // æŸ¯ä¼Šä¼¯å¸¦ç¼“æ…¢æ—‹è½¬
            if (kuiperBeltMesh && timeSpeed > 0) {
                kuiperBeltMesh.rotation.y += 0.0002 * delta * timeSpeed;
            }

            // è½¨é“è¿åŠ¨ç¼©æ”¾ç³»æ•°
            // ç”¨äºåŒ¹é… timeSpeed: å½“ timeSpeed=1 (1å¤©/ç§’) æ—¶ï¼Œæœˆçƒ(å‘¨æœŸ27.3å¤©)åº”åœ¨çº¦27.3ç§’è½¬ä¸€åœˆ
            // æœˆçƒ speed å‚æ•°çº¦ä¸º 0.05
            // éœ€è¦: 0.05 * orbitScale * delta = (2*PI / 27.3) * delta
            // orbitScale â‰ˆ 4.6
            const orbitScale = 4.6;

            // æ›´æ–°è¡Œæ˜Ÿ
            planets.forEach(p => {
                // æ¨¡æ‹Ÿæ¨¡å¼
                // æ¸…é™¤ tooltip åç¼€
                if (p.mesh.userData.tooltipSuffix) delete p.mesh.userData.tooltipSuffix;

                // å¦‚æœ timeSpeed ä¸º 0ï¼Œåœæ­¢å…¬è½¬å’Œè‡ªè½¬
                if (timeSpeed > 0) {
                    // ä½¿ç”¨ delta ç¡®ä¿å¸§ç‡æ— å…³çš„å¹³æ»‘è¿åŠ¨
                    
                    // ä¿®æ”¹ï¼šä½¿ç”¨ orbitalPeriod è®¡ç®—æ¯æ—¥è§’é€Ÿåº¦ (å¦‚æœå­˜åœ¨)
                    if (p.orbitalPeriod) {
                        // æ¯æ—¥æ—‹è½¬å¼§åº¦ = 2 * PI / å‘¨æœŸ(å¤©)
                        // simulatedDays å¢åŠ é‡ = delta * timeSpeed
                        // è§’åº¦å¢åŠ é‡ = (2 * PI / å‘¨æœŸ) * (delta * timeSpeed)
                        p.angle += (2 * Math.PI / p.orbitalPeriod) * delta * timeSpeed;
                    } else {
                        // å…¼å®¹æ—§é€»è¾‘ (å«æ˜Ÿç­‰)
                        p.angle += p.speed * orbitScale * delta * timeSpeed; 
                    }
                    
                    // å¼€æ™®å‹’æ–¹ç¨‹æ±‚è§£: M = E - e sin(E)
                    // p.angle è§†ä¸ºå¹³è¿‘ç‚¹è§’ M (Mean Anomaly)
                    let M = p.angle;
                    let e = p.eccentricity;
                    let E = M; // åˆå§‹çŒœæµ‹ E â‰ˆ M
                    
                    // ç‰›é¡¿è¿­ä»£æ³•æ±‚è§£åè¿‘ç‚¹è§’ E (Eccentric Anomaly)
                    if (e > 0.001) {
                        for (let i = 0; i < 5; i++) {
                             E = E - (E - e * Math.sin(E) - M) / (1 - e * Math.cos(E));
                        }
                    }
                    
                    // æ›´æ–°è¡Œæ˜Ÿç³»ç»Ÿä½ç½® (æ¤­åœ†è½¨é“æ–¹ç¨‹)
                    // å¤ªé˜³ä½äºç„¦ç‚¹ (0,0,0)
                    p.systemGroup.position.x = p.distance * Math.cos(E) - p.focusOffset;
                    p.systemGroup.position.z = p.semiMinor * Math.sin(E);
                    
                    // è‡ªè½¬ (ä¼°ç®—)
                    p.mesh.rotation.y += p.rotateSpeed * 60 * delta * timeSpeed;
                    
                    // åœ°çƒäº‘å±‚ç‹¬ç«‹æ—‹è½¬
                    if (p.mesh.userData.clouds) {
                        p.mesh.userData.clouds.rotation.y += p.rotateSpeed * 1.1 * 60 * delta * timeSpeed; 
                    }

                    // æ›´æ–°å«æ˜Ÿ
                    if (p.moons) {
                        p.moons.forEach(m => {
                            if (m.orbitalPeriod) {
                                m.angle += (2 * Math.PI / m.orbitalPeriod) * delta * timeSpeed;
                            } else {
                                m.angle += m.speed * orbitScale * delta * timeSpeed;
                            }
                            // æ›´æ–°å«æ˜Ÿåœ¨ group å†…éƒ¨çš„å±€éƒ¨åæ ‡ (x, z)
                            // ç”±äº group å·²ç»å€¾æ–œï¼Œå«æ˜Ÿä¼šè‡ªåŠ¨åœ¨å€¾æ–œå¹³é¢ä¸Šè¿åŠ¨
                            m.mesh.position.x = Math.cos(m.angle) * m.distance;
                            m.mesh.position.z = Math.sin(m.angle) * m.distance;
                            // y ä¿æŒ 0
                        });
                    }
                }
            });

            // æ›´æ–°å½—å°¾
            if (cometTails.length > 0) {
                const sunPos = new THREE.Vector3(0,0,0);
                cometTails.forEach(tail => {
                    // è·å–å½—æ˜Ÿä¸–ç•Œåæ ‡
                    const cometPos = new THREE.Vector3();
                    tail.target.getWorldPosition(cometPos);
                    
                    // æ›´æ–°ä½ç½®
                    tail.mesh.position.copy(cometPos);
                    
                    // è®¡ç®—æœå‘ï¼šå½—å°¾å§‹ç»ˆèƒŒå‘å¤ªé˜³
                    // å‘é‡ = å½—æ˜Ÿä½ç½® - å¤ªé˜³ä½ç½®
                    const direction = new THREE.Vector3().subVectors(cometPos, sunPos).normalize();
                    // è®¡ç®—ç›®æ ‡ç‚¹ï¼šå½—æ˜Ÿä½ç½® + æ–¹å‘å‘é‡ * é•¿åº¦
                    const target = cometPos.clone().add(direction);
                    tail.mesh.lookAt(target);
                    
                    // åŠ¨æ€è°ƒæ•´é•¿åº¦å’Œé€æ˜åº¦ (ç¦»å¤ªé˜³è¶Šè¿‘ï¼Œå°¾å·´è¶Šé•¿è¶Šäº®)
                    const distanceToSun = cometPos.distanceTo(sunPos);
                    // ç®€å•çš„çº¿æ€§è¡°å‡æ¨¡å‹
                    // å‡è®¾è¿‘æ—¥ç‚¹ 40ï¼Œè¿œæ—¥ç‚¹ 900
                    // åœ¨ 40 æ—¶ scale 1.5, åœ¨ 300 æ—¶ scale 0.1
                    let scale = Math.max(0.1, 1.5 - (distanceToSun / 400));
                    
                    // Zè½´æ˜¯é•¿åº¦æ–¹å‘
                    tail.mesh.scale.set(scale, scale, scale * 1.5); 
                    tail.mesh.material.opacity = Math.max(0, scale * 0.8);
                });
            }


            // å°„çº¿æ£€æµ‹
            // åªæœ‰åœ¨æœªèšç„¦ä¸”é¼ æ ‡æ‚¬åœæ—¶æ‰æ˜¾ç¤º tooltip
            if (!isFocused) {
                raycaster.setFromCamera(mouse, camera);
                raycaster.params.Points.threshold = 2; // è®¾ç½®ç‚¹äº‘æ£€æµ‹é˜ˆå€¼ï¼Œæ›´å®¹æ˜“é€‰ä¸­

                const targetObjects = [sun];
                if (asteroidBeltMesh) targetObjects.push(asteroidBeltMesh); // æ·»åŠ å°è¡Œæ˜Ÿå¸¦

                planets.forEach(p => {
                    targetObjects.push(p.mesh);
                    if (p.moons) {
                        p.moons.forEach(m => targetObjects.push(m.mesh));
                    }
                });
                
                const intersects = raycaster.intersectObjects(targetObjects, false); 
                
                if (intersects.length > 0) {
                    const object = intersects[0].object;
                    let name = object.userData.name;
                    if (!name && object === sun) name = "å¤ªé˜³";
                    
                    // é™„åŠ é¢å¤–ä¿¡æ¯ (å¦‚é€Ÿåº¦)
                    if (object.userData.tooltipSuffix) {
                        name += object.userData.tooltipSuffix;
                    }
                    
                    if (name) {
                        tooltip.innerText = name;
                        tooltip.style.display = 'block';
                        document.body.style.cursor = 'pointer';
                    }
                } else {
                    tooltip.style.display = 'none';
                    document.body.style.cursor = 'default';
                }
            } else {
                tooltip.style.display = 'none';
                document.body.style.cursor = 'default';
            }

            TWEEN.update(); // æ›´æ–°åŠ¨ç”»

            // èšç„¦è·Ÿéšé€»è¾‘
            if (isFocused && focusedObject) {
                 const targetPos = new THREE.Vector3();
                 focusedObject.getWorldPosition(targetPos);
                 
                 // å¹³æ»‘ç§»åŠ¨ controls.target åˆ°ç‰©ä½“å½“å‰ä½ç½®
                 // æˆ‘ä»¬ä¸éœ€è¦æ¯ä¸€å¸§éƒ½ Tweenï¼Œç›´æ¥è®¾ç½® target å³å¯ï¼Œå› ä¸º OrbitControls ä¼šå¤„ç†
                 // ä½†ä¸ºäº†é¿å…ç¬ç§»ï¼Œæˆ‘ä»¬ä½¿ç”¨ç®€å•çš„ lerp
                 controls.target.lerp(targetPos, 0.1);
            }

            controls.update();
            renderer.render(scene, camera);
        }

        animate();

        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
